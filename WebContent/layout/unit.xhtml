<?xml version="1.0" encoding="UTF-8"?> 
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich">

<h1>#{title}</h1>
<table style="width:100%">
<tr><td class="header">
<div class="#{userSession.tbunit.treatmentHealthUnit?'hu-icon':'ds-icon'}">
	<h:form style="margin:0px">
	<div style="float:right;">
		<a:region>
		<a:commandLink value="#{messages['medicines.selunit']}" action="#{unitSelection.startSelecting}" reRender="units,unitCount" 
			onclick="showUnitSelDlg();" rendered="#{selunit=='1'}" ajaxSingle="true" focus="unitname"/>
		</a:region>
	</div>
	</h:form>
	<div style="font-size:14px;">
	#{userSession.tbunit.name}
	</div>
	<div style="font-size:9px">
		#{userSession.tbunit.adminUnit.name} - #{userSession.tbunit.adminUnit.parent.name}
	</div>
</div>
</td></tr>
<tr><td style="padding:4px;">

  <ui:insert />
</td></tr>
</table>

<s:fragment id="sf" rendered="#{selunit=='1'}">
<rich:modalPanel id="unitSelDlg" autosized="true" width="490" zindex="2000" style="background-color:#F2F5F0">
	<f:facet name="header">
		<h:outputText value="#{messages['medicines.selunit']}" />
	</f:facet>
	<div id="unitform"><h:form id="frmunit" style="margin:0px">
	<a:region>
	<span id="unitname">
		<h:inputText value="#{unitSelection.name}" style="width:98%;margin-bottom:5px;" autocomplete="off">
			<a:support event="onkeyup" reRender="units,unitCount" requestDelay="500" ajaxSingle="true" 
				action="#{unitSelection.startSelecting}" />
		</h:inputText>
	</span>
	</a:region>
	<div id="unitid">
		<h:inputHidden value="#{unitSelection.unitId}" />
	</div>
	<h:outputText id="unitCount" value="#{unitSelection.unitCountText}" style="display:block;clear:both;font-weight:bold;" />

	<div style="overflow: auto; width: 98%; height: 280px;border: 1px gray solid; padding:0px; margin: 0px;background-color:white;">
	<h:panelGroup id="units">
		<s:fragment rendered="#{not unitSelection.selecting}">
			<div style="padding: 10px; margin-top: 40px; margin-left: 120px; margin-right: 120px;margin-bottom:60px;border:4px double #b0b0b0;">
			<s:span style="color:#d0d0d0" styleClass="wait-icon" rendered="#{not unitSelection.selecting}">
				#{messages['global.wait']}
			</s:span>
			</div>
		</s:fragment>
		<s:fragment rendered="#{unitSelection.selecting}">
		<a:repeat value="#{unitSelection.items}" var="it">
			<div class="paragraph" style="padding:4px;margin-top:10px;width:98%">
				#{it.name}
			</div>
			<h:dataTable value="#{it.units}" var="u" >
			<h:column>
  				<a:commandLink onclick="selectUnit(#{u.id}); return false;" 
  					styleClass="#{u.treatmentHealthUnit?'hu-icon':'ds-icon'}" style="width:100%;">
  					<span class="#{u.medicineManagementStarted?'':'warn-icon'}" title="#{u.medicineManagementStarted?'':messages['medicines.start.alert']}">
  						#{u.name}
  					</span>
  				</a:commandLink>
			</h:column>
			</h:dataTable>
		</a:repeat>
		</s:fragment>
	</h:panelGroup>
	</div>
	</h:form>
	</div>
	<div class="button-bar">
		<s:link styleClass="button-alt" onclick="hideUnitSelDlg(); return false;">
			<span>#{messages['form.cancel']}</span>
		</s:link>
	</div>
</rich:modalPanel>

<script type="text/javascript">
function showUnitSelDlg() {
	showModalAutoTop('unitSelDlg');
	jQuery("#unitname input").val("");
}
function hideUnitSelDlg() {
	Richfaces.hideModalPanel('unitSelDlg');
}
</script>
<h:form>
<a:jsFunction name="selectUnit" ajaxSingle="true" action="#{unitSelection.selectUnit}" reRender="main">
	<a:actionparam name="param1" assignTo="#{unitSelection.unitId}" converter="javax.faces.Integer" />
</a:jsFunction>
</h:form>

</s:fragment>
</ui:composition>
