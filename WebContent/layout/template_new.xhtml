<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      xmlns:c="http://java.sun.com/jstl/core">
<f:view contentType="text/html"/>
<head>
<title>#{title}</title>
<meta http-equiv="keywords" content="eTB Manager,MSH,DR-TB,TB,Tuberculosis,Second Line,First Line" />
<meta http-equiv="description" content="eTB Manager System" />
<meta http-equiv="Expires" content="0" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="Pragma" content="no-cache" />
  
<a:loadStyle src="/public/themes/green/skin.css" />
<a:loadScript src="resource://org/richfaces/renderkit/html/scripts/jquery/jquery.js"/>
<a:loadScript src="/js/jquery.maskedinput-1.1.3.pack.js"/>

<ui:insert name="head" />
</head>

<body>
<f:view>

<div class="page-header">
<div class="page-header-wrapper">
	<div class="page-header-left">
	</div>
	<div class="page-header-right">
		<a:form>
		<rich:dropDownMenu styleClass="user-data">
			<f:facet name="label">
			<div class="icon-user-header"></div>
			#{userLogin.user.name}
			</f:facet>
			<rich:menuItem value="#{messages['usersettings.preferences']}" submitMode="none"
				onclick="document.location.href='#{request.contextPath}/others/usersettings.seam'" />
			<rich:menuItem value="#{messages['changepwd']}" submitMode="none" 
				onclick="document.location.href='#{request.contextPath}/others/changepassword.seam'" />
			<rich:menuItem value="#{messages['form.exit']}" action="#{authenticator.logout}" submitMode="server"/>
			<rich:menuSeparator />
			<rich:menuItem value="#{messages['User.language']}" submitMode="none" disabled="true"/>
			<rich:menuSeparator />
			<c:forEach items="#{localeSelector.supportedLocales}" var="it">
				<rich:menuItem value="#{it.label}" submitMode="none" 
					onclick="changeLang('#{it.value}')" iconClass="#{localeSelector.localeString==it.value?'icon-bullet-menu':''}">
				</rich:menuItem>
			</c:forEach>
		</rich:dropDownMenu>
		</a:form>
	</div>


	<div class="top-menu">
		<div class="item #{empty topmenu?'selected':'unselected'}">
			<s:link value="#{messages['home']}" view="/home.xhtml" propagation="none"/>
		</div>
		<s:fragment rendered="#{s:hasRole('CASEMAN')}">
			<div class="item #{topmenu=='0'?'selected':'unselected'}">
				<s:link value="#{messages['cases']}" view="/cases/index.xhtml" propagation="none"/>
			</div>
		</s:fragment>
		<s:fragment rendered="#{s:hasRole('MEDMAN')}">
			<div class="item #{topmenu=='1'?'selected':'unselected'}">
				<s:link value="#{messages['medicines']}" view="/medicines/index.xhtml"  propagation="none"/>
			</div>
		</s:fragment>
		<s:fragment rendered="#{s:hasRole('MANAGEMENT')}">
			<div class="item #{topmenu=='2'?'selected':'unselected'}">
				<s:link value="#{messages['manag']}" view="/management/index.xhtml" propagation="none"/>
			</div>
		</s:fragment>
		<s:fragment rendered="#{s:hasRole('ADMIN')}">
			<div class="item #{topmenu=='3'?'selected':'unselected'}">
				<s:link value="#{messages['admin']}" view="/admin/index.xhtml" propagation="none"/>
			</div>
		</s:fragment>
	</div>
</div>
</div>

<div class="sub-menu">
	<div class="sub-menu-wrapper">
	<h:form>
		<rich:dropDownMenu styleClass="workspace-data" 
			onexpand="if (!window.wslist) {initWorkspaceList();}" 
			oncollapse="unhoverWorkspace()"
			popupWidth="270px" event="onclick">
			<f:facet name="label">
				<h:panelGroup>
					<h:graphicImage value="#{workspaceViewService.view.pictureURI}" rendered="#{not empty workspaceViewService.view.pictureURI}"/>
					<span class="workspace-name">#{defaultWorkspace.name}</span>
				</h:panelGroup>
			</f:facet>
			<rich:menuItem submitMode="none" disabled="true">
				<h:panelGroup id="pnlwslist">
					<a:repeat value="#{userSettings.userWorkspaces}" var="it" rendered="#{userWsInited}">
						<a:commandLink onclick="changeWorkspace(#{it.id});" styleClass="workspace-link">
							<h:graphicImage value="#{it.workspace.view.pictureURI}" rendered="#{it.workspace.view.pictureURI != null}"/>
							<span>#{it.workspace.name}</span>
						</a:commandLink>
					</a:repeat>
				</h:panelGroup>
			</rich:menuItem>
		</rich:dropDownMenu>
		<div class="naveg">
		<ui:insert name="naveg" />
		</div>
	</h:form>
	</div>
</div>




<div class="page-content">
<div class="page-content-wrapper">
	<table width="100%">
	<tr>
		<s:fragment rendered="#{empty left}">
		<td class="left-content">
			<ui:insert name="left" />
		</td>
		</s:fragment>
		<td class="central-content">
			<h:panelGroup id="messages">
    			<h:messages globalOnly="true" layout="table" styleClass="global-messages" />
    		</h:panelGroup>
    		<ui:insert name="content" />
		</td>
	</tr>
	</table>
</div>
</div>

<div class="page-footer">
	<div class="page-footer-wrapper">
	<p class="credit">#{messages['login.copyright']}<br/>
	Developed by <a href="http://www.msh.org/">MSH</a>
	</p>
	</div>
</div>



<ui:include src="/layout/waitdlg.xhtml" />
<a:status onstart="openWaitDlg();" onstop="closeWaitDlg();"></a:status>

<script type="text/javascript">
<!--
A4J.AJAX.onError=function(req, status, message) {
	window.alert('#{messages['mdrtbsys.request_error']}' + '... Request=' + req + ', Status=' + status + ', Message=' +  message);
	closeWaitDlg();
}
jQuery('.workspace-data').hover(function(){
	jQuery(this).addClass('workspace-data-selected');
}, function(){
	jQuery(this).removeClass('workspace-data-selected');
});
function unhoverWorkspace(){jQuery('.workspace-data').removeClass('workspace-data-selected');}
function changeLang(lang) {
	var s=document.location.href;
	var slang='lang='+lang;
	if (s.indexOf('lang=')>=0) {
		var currlang='lang=#{localeSelector.localeString}';
		document.location.href=s.replace(currlang,slang);
	}
	else {
		s+=(s.indexOf('?')==-1?'?':'&')+slang; 
		document.location.href=s;
	}
}
function showModalAutoTop(name, val) {
	val = (windowPosTop()+(val?val:100))+'px';
	Richfaces.showModalPanel(name, {top:val});
}
function windowPosTop() { return jQuery("body").scrollTop(); }
function disableButton(button) {
	if (jQuery(button).is(".button-disabled"))	return false;
	var el=jQuery('span', button);
	var s=el.text();
	el.html('<div class="wait-icon2"/>' + s);
	jQuery(button).addClass("button-disabled");
	return true;
}
function enableButton() { 
	jQuery('.button-disabled').each(function() {
	var s=jQuery(this).removeClass("button-disabled").text();
	jQuery('span',this).html(s);
	});
}
-->
</script>

<h:form>
<a:jsFunction name="initWorkspaceList" ajaxSingle="true" 
	reRender="pnlwslist" 
	action="#{userSession.initWorkspaceList}"
	oncomplete="window.wslist=true;" 
	/>

<a:jsFunction name="changeWorkspace" ajaxSingle="true" action="#{userSession.changeUserWorkspace}" >
	<a:actionparam name="param1" assignTo="#{userSession.userWorkspaceId}" converter="javax.faces.Integer" />
</a:jsFunction>
</h:form>

<ui:insert name="dialogs" />


</f:view>

</body>
</html>
