<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
 	  xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      template="..#{workspaceViewService.templatePage}">

<ui:param name="title" value="#{messages['manag.forecast.med']}" />

<ui:param name="topmenu" value="2" />
<ui:param name="waitdlg" value="1" />
<ui:param name="labelstyle" value="width:210px;" />
<ui:param name="left" value="0" />

<ui:define name="body">
<h:form id="main">

<table width="100%" style="border:2px solid #e0e0e0;border-collapse:collapse;">
<tr><td class="header">
	<ui:param name="color" value="#DDEEE0" />
	<s:button value="#{messages['form.return']}" view="/management/forecasting.xhtml" styleClass="button" style="float:right;" />
	<div style="padding:6px;">
	<img src="../img/forecast2.gif" style="float:left;padding-right:4px;" />
	<b>#{forecasting.name}</b>
	<br/>
	<h:outputText value="#{forecasting.recordingDate}" style="font-size:9px;">
		<f:convertDateTime timeZone="#{timezones.default}" type="both"/>
	</h:outputText>
	</div>

</td></tr>
<tr><td>

<table width="100%" style="border-collapse: collapse;">
<tr>
	<td>
		<s:decorate template="/layout/display.xhtml">
			<ui:define name="label">#{messages['admin.medicines']}:</ui:define>
			#{messages[forecasting.medicineLine.key]}
		</s:decorate>
	</td>
</tr>
<tr>
	<td>
		<s:fragment rendered="#{forecasting.view == 'TBUNIT'}">
		</s:fragment>
		<s:fragment rendered="#{forecasting.view == 'TBUNIT'}">
			<s:decorate template="/layout/tbunitdisplay.xhtml">
				<ui:define name="label">#{messages['TbUnit']}:</ui:define>
				<ui:param name="unit" value="#{forecastingHome.tbunitSelection.tbunit}" />
			</s:decorate>
		</s:fragment>
	</td>
	<td>
	</td>
</tr>
<tr>
	<td valign="top" >
	<s:decorate template="/layout/display.xhtml" >
		<ui:define name="label">#{messages['manag.forecast.refdate']}:</ui:define>
		<h:outputText value="#{forecasting.referenceDate}" converter="localeDateConverter" />
	</s:decorate>
	
	</td>
	<td>

	<s:decorate template="/layout/display.xhtml">
		<ui:define name="label">#{messages['manag.forecast.leadtime']}:</ui:define>
		<h:outputText value="#{forecasting.referenceDate}" converter="periodConverter" >
			<f:param name="endDate" value="#{forecasting.iniDate}"/>
			<f:param name="type" value="length" />
		</h:outputText>
	</s:decorate>

	</td></tr>
	<tr><td>
		
	</td></tr>
	<tr><td>

	<s:decorate template="/layout/display.xhtml">
		<ui:define name="label">#{messages['manag.forecast.bufferStock']}:</ui:define>
		#{forecasting.bufferStock} #{messages['global.months']}
	</s:decorate>

	</td><td>

	<s:decorate template="/layout/display.xhtml">
		<ui:define name="label">#{messages['manag.forecast.context']}:</ui:define>
		<h:outputText value="#{messages[forecasting.view.key]}" >
		</h:outputText>
		<h:outputText value="- #{forecasting.administrativeUnit.name}" rendered="#{forecasting.view=='ADMINUNIT'}" />
		<h:outputText value="- #{forecasting.tbunit.name}" rendered="#{forecasting.view=='TBUNIT'}"/>
	</s:decorate>
	
	</td></tr>
	<tr><td>

	<s:decorate template="/layout/display.xhtml">
		<ui:define name="label">#{messages['manag.forecast.numcases']}:</ui:define>
		<h:outputText value="#{forecasting.numCasesOnTreatment}" >
			<f:convertNumber pattern="#,###,##0"/>
		</h:outputText>
	</s:decorate>

	</td><td>


</td></tr>
<tr><td valign="top" colspan="2">

<rich:tabPanel width="100%" switchType="client">
<rich:tab label="#{messages['manag.forecast.tabres1']}">
	<h:dataTable value="#{forecasting.medicines}" var="m" styleClass="tabela" rowClasses="lin1,lin2" 
		columnClasses="colb,colrb,colrb,colrb,colrb,colrb hlcolor,colrb hlcolor,colrb hlcolor,colrb hlcolor,colrb,colrb">
		<h:column>
			<f:facet name="header">
				#{messages['Medicine']}
			</f:facet>
			#{m.medicine}
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['manag.forecast.stockonhand']}
			</f:facet>
			<h:outputText value="#{m.stockOnHand}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['manag.forecast.stockonorder']}
			</f:facet>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['manag.forecast.dispensingLeadTime']}
			</f:facet>
			<h:outputText value="#{m.dispensingLeadTime}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['manag.forecast.stockafterleadtime']}
			</f:facet>
			<h:outputText value="#{m.stockOnHandAfterLeadTime}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['manag.forecast.estcases']}
			</f:facet>
			<h:outputText value="#{m.estimatedQtyCases}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['manag.forecast.estnewcases']}
			</f:facet>
			<h:outputText value="#{m.estimatedQtyNewCases}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['manag.forecast.estqty']}
			</f:facet>
			<b>
			<h:outputText value="#{m.estimatedQty}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
			</b>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['global.unitPrice']}
			</f:facet>
			<h:outputText value="#{m.unitPrice}" >
				<f:convertNumber pattern="#,###,##0.0000"/>
			</h:outputText>
		</h:column>
		
		<h:column>
			<f:facet name="header">
				#{messages['global.totalPrice']}
			</f:facet>
			<h:outputText value="#{m.totalPrice}" >
				<f:convertNumber pattern="#,###,##0.00"/>
			</h:outputText>
		</h:column>
	</h:dataTable>
</rich:tab>

<rich:tab label="#{messages['manag.forecast.tabres2']}">
<table width="100%" class="tabela">
<tr>
	<th colspan="2">#{messages['Medicine']}
	</th>
	<a:repeat value="#{forecastingView.resultTable.columns}" var="it">
	<th>
		#{it}
	</th>
	</a:repeat>
</tr>
<a:repeat value="#{forecastingView.resultTable.rows}" var="r">
<tr class="highlight">
	<td rowspan="3" class="colb">
		#{r.medicine.medicine}
	</td>
	<td class="colb">
		#{messages['manag.forecast.stockonhand']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.stockOnHand}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.tabres2.cell1']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.quantityCasesOnTreatment}" rendered="#{s.quantityCasesOnTreatment!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.tabres2.cell2']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.quantityNewCases}" rendered="#{s.quantityNewCases!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
</a:repeat>
</table>
</rich:tab>

<rich:tab label="#{messages['manag.forecast.tabres3']}">
<table width="100%" class="tabela">
<tr>
	<th colspan="2">#{messages['Medicine']}
	</th>
	<a:repeat value="#{forecastingView.resultTable.columns}" var="it">
	<th>
		#{it}
	</th>
	</a:repeat>
</tr>
<a:repeat value="#{forecastingView.resultTable.rows}" var="r">
<tr>
	<td rowspan="3" class="colb highlight">
		#{r.medicine.medicine}
	</td>
	<td class="colb">
		#{messages['manag.forecast.tabres3.cell1']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.numCasesOnTreatment}" rendered="#{s.numCasesOnTreatment!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.tabres3.cell2']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.numNewCases}" rendered="#{s.numNewCases!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr class="highlight">
	<td class="colb">
		#{messages['global.total']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.totalCases}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
</a:repeat>
</table>
</rich:tab>

</rich:tabPanel>
</td></tr>
</table>

</td></tr></table>
</h:form>
</ui:define>

</ui:composition>  

