<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
 	  xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      >


<rich:tab id="tabresult" label="#{messages['manag.forecast.tabres1']}" rendered="#{forecasting.hasResult and facesContext.renderResponse}">
	<table class="tabela">
	<tr>
		<th rowspan="2">
			#{messages['Medicine']}
		</th>
		<th rowspan="2">
			#{messages['manag.forecast.stockonhand']}
		</th>
		<th colspan="3">
			#{messages['manag.forecast.leadtime']}
			<br/>
			<h:outputText value="#{forecastingCalculation.leadTimePeriod}" converter="periodConverter" styleClass="small-text"/>
		</th>
		<th colspan="8">
			#{messages['manag.forecast.reviewperiod']}
			<br/>
			<h:outputText value="#{forecastingCalculation.reviewPeriod}" converter="periodConverter" styleClass="small-text"/>
		</th>
	</tr>
	<tr>
		<th>
			#{messages['manag.forecast.stockonorder']}
		</th>
		<th>
			#{messages['manag.forecast.dispensingLeadTime']}
		</th>
		<th>
			#{messages['manag.forecast.expiredquantity']}
		</th>

		<th>
			#{messages['manag.forecast.stockafterleadtime']}
		</th>
		<th>
			#{messages['manag.forecast.stockonorder']}
		</th>
		<th>
			#{messages['manag.forecast.expiredquantity']}
		</th>
		<th>
			#{messages['manag.forecast.estcases']}
		</th>
		<th>
			#{messages['manag.forecast.estnewcases']}
		</th>
		<th>
			#{messages['manag.forecast.estqty']}
		</th>
		<th>
			#{messages['global.unitPrice']}
		</th>
		<th>
			#{messages['global.totalPrice']}
		</th>
	</tr>
	<a:repeat value="#{forecasting.medicines}" var="m">
	<tr>
		<td class="colb">
			#{m.medicine}
		</td>
		<td class="colrb">
			<h:outputText value="#{m.stockOnHand}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb highlight">
			<h:outputText value="#{m.stockOnOrderLT}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb highlight">
			<h:outputText value="#{m.consumptionLT}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>

		<td class="colrb highlight">
			<h:outputText value="#{m.quantityExpiredLT}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.stockOnHandAfterLT}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.stockOnOrder}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.quantityExpired}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.consumptionCases}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.consumptionNewCases}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.estimatedQty}" >
				<f:convertNumber pattern="#,###,##0"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.unitPrice}" >
				<f:convertNumber pattern="#,###,##0.00"/>
			</h:outputText>
		</td>
		<td class="colrb">
			<h:outputText value="#{m.totalPrice}" >
				<f:convertNumber pattern="#,###,##0.00"/>
			</h:outputText>
		</td>
	</tr>
	</a:repeat>
	</table>

</rich:tab>



<rich:tab label="#{messages['manag.forecast.tabres2']}" rendered="#{forecasting.hasResult}">
<table width="100%" class="tabela">
<tr>
	<th colspan="2">#{messages['Medicine']}
	</th>
	<a:repeat value="#{forecastingView.resultTable.columns}" var="it">
	<th>
		#{it}
	</th>
	</a:repeat>
</tr>
<a:repeat value="#{forecastingView.resultTable.rows}" var="r">
<tr class="highlight">
	<td rowspan="6" class="colb">
		#{r.medicine.medicine}
	</td>
	<td class="colb">
		#{messages['manag.forecast.stockonhand']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.stockOnHand}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.stockonorder']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.stockOnOrder}" rendered="#{s.stockOnOrder!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.tabres2.cell1']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.consumptionCases}" rendered="#{s.consumptionCases!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.tabres2.cell2']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.consumptionNewCases}" rendered="#{s.consumptionNewCases!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.tabres2.cell3']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.quantityExpired}" rendered="#{s.quantityExpired!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.batchtoexpire']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.quantityToExpire}" >
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
		<a:commandLink rendered="#{not empty s.batchesConsumed}" 
			onclick="showDetailResult(#{s.medicine.id},#{s.monthIndex}); return false;" styleClass="plus-icon" style="float:right;">
		</a:commandLink>
	</td>
	</a:repeat>
</tr>
</a:repeat>
</table>
</rich:tab>



<rich:tab label="#{messages['manag.forecast.tabres3']}" rendered="#{forecasting.hasResult}">
<table width="100%" class="tabela">
<tr>
	<th colspan="2">#{messages['Medicine']}
	</th>
	<a:repeat value="#{forecastingView.resultTable.columns}" var="it">
	<th>
		#{it}
	</th>
	</a:repeat>
</tr>
<a:repeat value="#{forecastingView.resultTable.rows}" var="r">
<tr>
	<td rowspan="3" class="colb highlight">
		#{r.medicine.medicine}
	</td>
	<td class="colb">
		#{messages['manag.forecast.tabres3.cell1']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.numCasesOnTreatment}" rendered="#{s.numCasesOnTreatment!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr>
	<td class="colb">
		#{messages['manag.forecast.tabres3.cell2']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.numNewCases}" rendered="#{s.numNewCases!=0}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
<tr class="highlight">
	<td class="colb">
		#{messages['global.total']}
	</td>
	<a:repeat value="#{r.results}" var="s">
	<td class="colrb">
		<h:outputText value="#{s.totalCases}">
			<f:convertNumber pattern="#,###,##0" />
		</h:outputText>
	</td>
	</a:repeat>
</tr>
</a:repeat>
</table>
</rich:tab>

<a:jsFunction name="showDetailResult" reRender="resultDetailsPnl" action="#{forecastingView.initializeResult}" 
	ajaxSingle="true" oncomplete="showModalAutoTop('resultDetailsDlg');">
	<a:actionparam name="param1" assignTo="#{forecastingView.medicineId}" converter="javax.faces.Integer" />
	<a:actionparam name="param2" assignTo="#{forecastingView.monthIndex}" converter="javax.faces.Integer" />
</a:jsFunction>

</ui:composition>  

