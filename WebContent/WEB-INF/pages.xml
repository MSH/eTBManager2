<?xml version="1.0" encoding="UTF-8"?>
<pages xmlns="http://jboss.com/products/seam/pages"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://jboss.com/products/seam/pages http://jboss.com/products/seam/pages-2.2.xsd"

       no-conversation-view-id="/home.xhtml"
       login-view-id="/login.xhtml">


	<page view-id="/home.xhtml" login-required="true" />
	<page view-id="/others/*" login-required="true" />
	<page view-id="/restricted/*" login-required="true" />
	<page view-id="/admin/*" login-required="true" >
		<restrict>#{s:hasRole('ADMIN')}</restrict>
	</page>
	<page view-id="/medicines/*" login-required="true" >
		<restrict>#{s:hasRole('MEDMAN')}</restrict>
	</page>
	<page view-id="/cases/*" login-required="true" >
		<restrict>#{s:hasRole('CASEMAN')}</restrict>
	</page>
	<page view-id="/management/*" login-required="true" >
		<restrict>#{s:hasRole('MANAGEMENT')}</restrict>
	</page>
	<page view-id="/reports/*" login-required="true" >
		<restrict>#{s:hasRole('MANAGEMENT')}</restrict>
	</page>

 	<page view-id="/custom/*" login-required="true" >
	</page>

    <page view-id="*" action="#{onlineUsers.update}">
        <navigation>
            <rule if-outcome="home">
                <redirect view-id="/home.xhtml"/>
            </rule>
            <rule if-outcome="med-home">
            	<redirect view-id="/medicines/index.xhtml" />
            </rule>
        </navigation>
    </page>
    
    <page view-id="/workspaceimg.xhtml" >
    	<rewrite pattern="/workspaceimg/{imgName}"/>
    	<param name="imgName" value="#{workspaceViewService.pictureFile}" />
    	<action execute="#{workspaceViewService.responseImage}"/>
    </page>
    

	<!-- PRODUCT GROUP -->
	<page view-id="/admin/groups.xhtml">
    	<restrict>#{s:hasRole('GROUPS')}</restrict>
		<param name="id" value="#{productGroupHome.id}" converterId="javax.faces.Integer" />
		<param name="order" value="#{productGroups.order}" />
	</page>
	
	<page view-id="/admin/edtgroup.xhtml">
    	<restrict>#{s:hasRole('GROUPS')}</restrict>
    	<param name="id" value="#{productGroupHome.id}" converterId="javax.faces.Integer"/>
    	<navigation>
    		<rule if-outcome="persisted">
    			<redirect view-id="/admin/groups.xhtml" />
    		</rule>
    	</navigation>		
	</page>


	<!-- DRUG ORDER -->
	
	<page view-id="/reports/orderdata.xhtml">
		<restrict>#{s:hasRole('ORDER_PRINT')}</restrict>
		<param name="id" value="#{orderHome.id}" converterId="javax.faces.Integer" />
	</page>
	
	<page view-id="/medicines/selbatch.xhtml" conversation-required="true" no-conversation-view-id="/medicines/orderdata.xhtml">
		<navigation>
			<rule if-outcome="success">
				<redirect view-id="/medicines/ordersent.xhtml"></redirect>
			</rule>
		</navigation>
	</page>
	

	<!-- CASE DISPENSING -->
		
	<page view-id="/medicines/dispnew.xhtml">
		<restrict>#{s:hasRole('DISPPAC_EDT')}</restrict>
		<param name="month" value="#{unitDispensing.month}" converterId="javax.faces.Integer" />
		<param name="year" value="#{unitDispensing.year}" converterId="javax.faces.Integer" />
		<param name="unitid" value="#{dispensingHome.unitId}" converterId="javax.faces.Integer" />
		<navigation>
			<rule if-outcome="persisted">
				<redirect view-id="/medicines/dispensing.xhtml">
				</redirect>
			</rule>
		</navigation>
	</page>

	<page view-id="/medicines/disppacdata.xhtml" >
		<restrict>#{s:hasRole('DISP_PAC')}</restrict>
		<param name="id" value="#{caseDispensingHome.id}" converterId="javax.faces.Integer" />
		<navigation>
			<rule if-outcome="removed">
				<redirect view-id="/medicines/disppac.xhtml">
				</redirect>
			</rule>
		</navigation>
	</page>
	
	<!-- MOVEMENTS -->

	<page view-id="/reports/movements.xhtml" action="#{movementFilters.initialize}">
		<restrict>#{s:hasRole('MOVS')}</restrict>
		<param name="firstResult" value="#{movements.firstResult}" />
<!-- 		<param name="firstResult" value="#{batchMovements.firstResult}" />  -->
		<param name="bt" value="#{movementFilters.batchesOutput}" converterId="javax.faces.Boolean"/>
		<param name="dt" value="#{movementFilters.date}" converterId="dateURLConverter" />
		<param name="mt" value="#{movementFilters.type}" />
		<param name="srcid" value="#{sourceHome.id}" converterId="javax.faces.Integer" />
		<param name="medid" value="#{medicineHome.id}" converterId="javax.faces.Integer" />
	</page>


	<!-- TRANSFER -->

	<page view-id="/reports/transfdata.xhtml">
		<restrict>#{s:hasRole('TRANSFER')}</restrict>
		<param name="id" value="#{transferHome.id}" converterId="javax.faces.Integer"/>
	</page>
	


	<page view-id="/medicines/unitsetupedt.xhtml">
		<restrict>#{s:hasRole('UNITSETUP')}</restrict>
		<begin-conversation join="true" />
		<action execute="#{unitSetup.initialize}"/>
		<navigation>
			<rule if-outcome="persisted">
				<end-conversation/>
				<redirect view-id="/medicines/unitsetup.xhtml">
					<message>#{messages['medicines.unitsetup.msgok']}</message>
				</redirect>
			</rule>
		</navigation>
	</page>


	<!-- REPORTS -->
	<page view-id="/reports/rel2.xhtml" >
		<restrict>#{s:hasRole('REP_ESTPOS')}</restrict>
		<param name="source" value="#{reportSelection.sourceId}" converterId="javax.faces.Integer" />
		<param name="ds" value="#{reportSelection.tbunitId}" converterId="javax.faces.Integer" />
	</page>

	<page view-id="/reports/rel3.xhtml">
		<restrict>#{s:hasRole('REP_STOCKEVOL')}</restrict>
		<param name="source" value="#{reportSelection.sourceId}" converterId="javax.faces.Integer" />
		<param name="ds" value="#{reportSelection.tbunitId}" converterId="javax.faces.Integer" />
		<param name="inimonth" value="#{reportSelection.iniMonth}" converterId="javax.faces.Integer" />
		<param name="iniyear" value="#{reportSelection.iniYear}" converterId="javax.faces.Integer" />
		<param name="endmonth" value="#{reportSelection.endMonth}" converterId="javax.faces.Integer" />
		<param name="endyear" value="#{reportSelection.endYear}" converterId="javax.faces.Integer" />
	</page>



    
    <exception class="org.jboss.seam.framework.EntityNotFoundException">
        <redirect view-id="/error.xhtml">
            <message>Not found</message>
        </redirect>
    </exception>
    
    <exception class="javax.persistence.EntityNotFoundException">
        <redirect view-id="/error.xhtml">
            <message>Not found</message>
        </redirect>
    </exception>
    
    <exception class="javax.persistence.OptimisticLockException">
        <end-conversation/>
        <redirect view-id="/error.xhtml">
            <message>Another user changed the same data, please try again</message>
        </redirect>
    </exception>
    
    <exception class="org.jboss.seam.security.AuthorizationException" log="false">
        <redirect view-id="/error.xhtml">
            <message>#{messages['exceptions.auth']}</message>
        </redirect>
    </exception>
    
    <exception class="javax.faces.application.ViewExpiredException" log="false">
        <redirect view-id="/login.xhtml">
        	<message>#{messages['org.jboss.seam.NotLoggedIn']}</message>
        </redirect>
    </exception>
    
    <exception class="org.jboss.seam.security.NotLoggedInException" log="false">
        <redirect view-id="/login.xhtml">
            <message>#{messages['org.jboss.seam.NotLoggedIn']}</message>
        </redirect>
    </exception>
    
    <exception class="javax.faces.validator.ValidatorException">
    	<end-conversation before-redirect="true"/>
    	<redirect view-id="/home.xhtml">
    		<message>#{messages['exceptions.val']}: #{org.jboss.seam.handledException.message}</message>
    	</redirect>
    </exception>

    <exception class="org.msh.tb.movs.MovementException">
    	<redirect view-id="/error.xhtml">
    		<message>Invalid stock transaction: #{org.jboss.seam.handledException.message}</message>
    	</redirect>
    </exception>
  
    <exception>
    	<end-conversation />
        <redirect view-id="/errorall.xhtml">
        </redirect>
    </exception>
    
</pages>
