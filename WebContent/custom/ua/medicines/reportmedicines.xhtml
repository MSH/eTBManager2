<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
 	  xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      template="/layout/templatemed.xhtml">

<ui:param name="title" value="#{messages['uk_UA.reportMed.title']}" />
<ui:param name="topmenu" value="1" />

<ui:param name="labelstyle" value="width:210px;" />


<ui:define name="naveg">
	<div class="item">
		<s:link value="#{messages['meds.inventory']}" view="/medicines/index.xhtml" propagation="none"/>
	</div>
	<div class="item selected">
		<s:link value="#{title}" propagation="none" />
	</div>
</ui:define>


<ui:define name="content_unit" id="content">
<h:form id="main">

	<s:decorate template="/layout/edit.xhtml">
    	<ui:define name="label">#{messages['Source']}:</ui:define>
		<h:selectOneMenu value="#{reportMed.source}" required="true">
  		<s:selectItems value="#{sources.resultList}" var="r" label="#{r.abbrevName}" noSelectionLabel="-" />
  		<s:convertEntity />
		<a:support event="onchange" ajaxSingle="true" />
		</h:selectOneMenu>
	</s:decorate>
	
    <s:decorate template="/custom/ua/layout/dateedit.xhtml" >
    	<ui:define name="label">#{messages['Period.iniDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{reportMed.iniDate}" /> 
    	<ui:param name="immediateSetter" value="true" />
    </s:decorate>

    <s:decorate template="/custom/ua/layout/dateedit.xhtml" >
    	<ui:define name="label">#{messages['Period.endDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{reportMed.endDate}" /> 
    	<ui:param name="immediateSetter" value="true" />
    </s:decorate>
    
   	<a:commandLink styleClass="button-alt" action="#{reportMed.clear()}" style="float:right;" 
   	onclick="if (!disableButton(this)) return false;" reRender="main,messages" oncomplete="enableButton();">
   		<span>#{messages['form.update']}</span>
   	</a:commandLink>
   	<span style="color:red;clear:both;">*</span> #{messages['javax.faces.component.UIInput.REQUIRED']}

<p/>

<h:panelGroup id="reportM" rendered="#{reportMed.resultList.size()!=0}">
<table class="table1" width="100%">
	<tr>
		<th rowspan="2">
			#{messages['uk_UA.reportMed.cols.brandName']}
		</th>
		<th rowspan="2">
			#{messages['Batch.manufacturer']}
		</th>
		<th rowspan="2">
			#{messages['Substance']}
		</th>
		<th rowspan="2">
			#{messages['uk_UA.reportMed.cols.type']}
		</th>
		<th rowspan="2">
			#{messages['uk_UA.reportMed.cols.registCard']}
		</th>
		<th rowspan="2">
			#{messages['Batch']}
		</th>
		<th rowspan="2">
			#{messages['Batch.expiryDate']}
		</th>
		<th rowspan="2">
			#{reportMed.storehouse?messages['uk_UA.reportMed.cols.invoice']:messages['uk_UA.reportMed.cols.orderNumber']}
		</th>
		<th rowspan="2">
			#{messages['uk_UA.reportMed.cols.stockIniDate']}
		</th>
		<th colspan="2">
			#{messages['uk_UA.reportMed.cols.getInPeriod']}
		</th>
		<th rowspan="2">
			#{messages['uk_UA.reportMed.cols.usedInPeriod']}
		</th>
	</tr>
	<tr>
		<th>
			#{reportMed.storehouse?messages['uk_UA.reportMed.cols.getInPeriod.receiv.fromManufacturer']:messages['uk_UA.reportMed.cols.getInPeriod.receiv']}
		</th>
		<th>
			#{reportMed.storehouse?messages['uk_UA.reportMed.cols.getInPeriod.transf.all']:messages['uk_UA.reportMed.cols.getInPeriod.transf']}
		</th>
	</tr>
	<a:repeat value="#{reportMed.resultList}" var="row">
		<s:fragment rendered="#{row.render}">
			<tr>
				<td>
					#{row.batch.brandName}
				</td>
				<td>
					#{row.batch.manufacturer}
				</td>
				<td>
					#{row.batch.medicine}
				</td>
				<td>
					#{row.batch.medicine.dosageForm}, â„–#{row.batch.quantityContainer}
				</td>
				<td style="#{(medCalcCont.isExpiringRegistCard(row.batch,6) or row.batch.registCardExpired)?'background-color:#A59898':''}">
					<s:fragment rendered="#{row.batch.registCardNumber!='' and row.batch.registCardNumber!=null}">
				    	#{row.batch.registCardNumber} 
				    </s:fragment>
				    <s:fragment rendered="#{row.batch.registCardEndDate != null}">
					    <h:outputText value=" #{messages['form.by']} "/> 
						<h:outputText value="#{row.batch.registCardEndDate}" converter="localeDateConverter" />
				    </s:fragment>
				</td>
				<td>
					#{row.batch.batchNumber}
				</td>
				<td style="#{(medCalcCont.isExpiringBatch(row.batch,6) or row.batch.expired)?'background-color:#A59898':''}">
					<h:outputText value="#{row.batch.expiryDate}" converter="#{localeDateConverter}"/>
				</td>
				<td>
					<h:outputText value="#{row.invoiceNumber}" rendered="#{reportMed.storehouse}"/>
					<h:outputText value="#{row.orderNumber}" rendered="#{!reportMed.storehouse}" />
				</td>
				<td>
					#{row.stockInIniDate}
				</td>
				<td>
					<h:outputText value="#{row.sumReceivings}" rendered="#{reportMed.storehouse}"/>
					<h:outputText value="#{row.sumTransFromNotTreatUnits}" rendered="#{!reportMed.storehouse}" />
				</td>
				<td>
					<h:outputText value="#{row.sumTransFromUnits}" rendered="#{reportMed.storehouse}"/>
					<h:outputText value="#{row.sumTransFromTreatUnits}" rendered="#{!reportMed.storehouse}" />
				</td>
				<td>
					#{row.dispensing}
				</td>
			</tr>
		</s:fragment>
	</a:repeat>
</table>
</h:panelGroup>

</h:form>
</ui:define>

</ui:composition>  
