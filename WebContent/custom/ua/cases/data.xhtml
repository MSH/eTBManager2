<?xml version="1.0" encoding="UTF-8"?> 
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
 	  			xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich">

	<div class="form1">
	<div class="form-content">	
	<h2>                 
		<s:link view="/cases/caseedt.xhtml" style="float:right;" 
			rendered="#{caseHome.canEditCaseData}" styleClass="button-alt"
			onclick="disableButton(this)">
			<f:param name="id" value="#{caseHome.id}" />
			<span>#{messages['form.edit']}</span>
		</s:link>
	#{messages['cases.patientdata']}</h2>
	
	<table style="border-collapse:collapse;width:100%;">
	<tr><td>
	
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['Patient.securityNumber']}:</ui:define>
		#{tbcase.registrationCode}
	</s:decorate>
	
	</td><td>
	
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['Gender']}:</ui:define>
		#{messages[tbcase.patient.gender.key]}
	</s:decorate>
	
	</td></tr>
	<tr><td>
	
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['Patient.birthDate']}:</ui:define>
    	<h:outputText id="dt" value="#{tbcase.patient.birthDate}" converter="localeDateConverter" />
	</s:decorate>
	
	</td><td>
	
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['TbCase.patientAge']}:</ui:define>
    	<h:outputText value="#{tbcase.patientAge}" style="padding-right:4px;" />#{messages['global.age']}
	</s:decorate>

	</td></tr>
    <tr><td colspan="2">
		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.nationality != null}">
    		<ui:define name="label">#{messages['Nationality']}:</ui:define>
    		<h:outputText value="#{messages[tbcase.nationality.key]}" />
		</s:decorate>

    </td></tr>
    <tr><td colspan="2">
    	<h2>#{messages['cases.details.addressnotif']}</h2>
	
		<s:decorate template="/layout/audisplay.xhtml">
			<ui:param name="adminunit" value="#{tbcase.notifAddress.adminUnit}" />
		</s:decorate>
		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label"><div style="height:34px;">#{messages['Address.address']}:</div></ui:define>
    		#{tbcase.notifAddress.address}
    		<br/>
    		#{tbcase.notifAddress.complement}
		</s:decorate>
	</td></tr>
	<tr><td>
		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.phoneNumber}">
    		<ui:define name="label">#{messages['TbCase.phoneNumber']}:</ui:define>
    		#{tbcase.phoneNumber}
		</s:decorate>
	</td>
	<td>
		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.mobileNumber}">
    		<ui:define name="label">#{messages['TbCase.mobileNumber']}:</ui:define>
    		#{tbcase.mobileNumber}
		</s:decorate>
	</td></tr>
    <tr><td>

    	<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['Address.zipCode']}:</ui:define>
    		#{tbcase.notifAddress.zipCode}
    	</s:decorate>
	</td><td>
		<s:decorate template="/layout/display.xhtml">
			<ui:define name="label">#{messages['LocalityType']}:</ui:define>
			#{messages[tbcase.notifAddress.localityType.key]}
		</s:decorate>
    </td></tr>
	<s:fragment rendered="#{tbcase.notifAddressChanged}">
	<tr><td colspan="2">
		<h2>#{messages['cases.details.addresscurr']}</h2>
		<s:decorate template="/layout/audisplay.xhtml">
			<ui:param name="adminunit" value="#{tbcase.currentAddress.adminUnit}" />
		</s:decorate>
	
		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label"><div style="height:34px;">#{messages['Address.address']}:</div></ui:define>
    		#{tbcase.currentAddress.address}
    		<br/>
    		#{tbcase.currentAddress.complement}
		</s:decorate>
	</td></tr>
	</s:fragment>
	<tr><td>
		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.phoneNumber}">
    		<ui:define name="label">#{messages['TbCase.phoneNumber']}:</ui:define>
    		#{tbcase.phoneNumber}
		</s:decorate>
	</td>
	<td>
		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.mobileNumber}">
    		<ui:define name="label">#{messages['TbCase.mobileNumber']}:</ui:define>
    		#{tbcase.mobileNumber}
		</s:decorate>
	</td></tr>
	<tr><td colspan="2">
		<s:decorate template="/layout/display.xhtml" rendered="#{caseDataUA.employerName!=null}">
    		<ui:define name="label">#{messages['uk_UA.employerName']}</ui:define>
    		#{caseDataUA.employerName}
		</s:decorate>

		<s:decorate template="/layout/displayfield.xhtml" rendered="#{caseDataUA.position!=null}">
    		<ui:define name="label">#{messages['TbField.POSITION']}:</ui:define>
    		<ui:param name="field" value="#{caseDataUA.position}" /> 
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{not empty caseDataUA.closestContact}">
    		<ui:define name="label">#{messages['TbCase.closestContact']}</ui:define>
    		#{caseDataUA.closestContact}
		</s:decorate>
	</td></tr>
	</table></div>
	


	<div class="form-content">
		<h2>#{messages['cases.generaldata']}</h2>
	
	<ui:param name="labelstyle" value="width:190px;" />
	<table style="border-collapse:collapse;width:98%;" cellpadding="1" >
	<tr><td colspan="2">
	<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.notificationUnit!=null}">
    	<ui:define name="label">#{messages['TbCase.notificationUnit']}:</ui:define>
    	#{tbcase.notificationUnit.name}
	</s:decorate>
	</td></tr>
	<tr><td colspan="2">
	<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.treatmentPeriod.iniDate!=null}">
    	<ui:define name="label">#{messages['Tbunit.treatmentHealthUnit']}:</ui:define>
    	#{tbcase.ownerUnit.name}
	</s:decorate>
	</td></tr>
	<tr><td colspan="2">
		<h2>#{messages['cases.details.currhist']}</h2>
	</td></tr>
	<tr><td>
	
	<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.classification=='DRTB'}">
		<ui:define name="label">#{messages['DiagnosisType']}:</ui:define>
		#{messages[tbcase.diagnosisType.key]}
	</s:decorate>

	<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.drugResistanceType}">
		<ui:define name="label">#{messages['DrugResistanceType']}</ui:define>
		#{messages[tbcase.drugResistanceType.key]}
	</s:decorate>
	</td><td>
	
	</td></tr>
	<tr><td valign="top">

		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.treatmentPeriod.iniDate}">
    		<ui:define name="label">#{messages['TbCase.iniTreatmentDate']}:</ui:define>
    		<h:outputText value="#{tbcase.treatmentPeriod.iniDate}" converter="localeDateConverter" />
		</s:decorate>

	</td><td>

		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.treatmentPeriod.endDate}">
    		<ui:define name="label">#{messages['TbCase.endTreatmentDate']}:</ui:define>
    		<h:outputText value="#{tbcase.treatmentPeriod.endDate}" converter="localeDateConverter" />
		</s:decorate>

	</td></tr>

	<tr><td valign="top">
		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['TbCase.diagnosisDate']}:</ui:define>
    		<h:outputText value="#{tbcase.diagnosisDate}" converter="localeDateConverter" />
		</s:decorate>
	</td>
	</tr>

	<tr><td valign="top">
		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['uk_UA.dateFirstSymptoms']}:</ui:define>
    		<h:outputText value="#{caseDataUA.dateFirstSymptoms}" converter="localeDateConverter" />
		</s:decorate>
	</td>
	<td valign="top">
		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['uk_UA.dateFirstVisitGMC']}:</ui:define>
    		<h:outputText value="#{caseDataUA.dateFirstVisitGMC}" converter="localeDateConverter" />
		</s:decorate>
	</td></tr>

	<tr>
	<td valign="top">
		<s:decorate template="/layout/display.xhtml" >
    		<ui:define name="label">#{messages['TbCase.registrationDate']}:</ui:define>
    		<h:outputText value="#{tbcase.registrationDate}" converter="localeDateConverter" />
		</s:decorate>
	
	</td><td>
		<s:decorate template="/layout/display.xhtml" >
    		<ui:define name="label">#{messages['uk_UA.hospitalizationDate']}:</ui:define>
    		<h:outputText value="#{caseDataUA.hospitalizationDate}" converter="localeDateConverter" />
		</s:decorate>

	</td></tr>
	
	<tr><td>
		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.patientType!=null}">
    		<ui:define name="label">#{messages['PatientType']}:</ui:define>
    		#{messages[tbcase.patientType.key]}
		</s:decorate>
	</td><td>
		<s:decorate template="/layout/display.xhtml" >
    		<ui:define name="label">#{messages['uk_UA.dischargeDate']}:</ui:define>
    		<h:outputText value="#{caseDataUA.dischargeDate}" converter="localeDateConverter" />
		</s:decorate>

	</td>
	
	</tr>

	<tr><td	colspan="2">
		<s:decorate template="/layout/displayfield.xhtml" rendered="#{caseDataUA.detection!=null}">
    		<ui:define name="label">#{messages['TbField.TBDETECTION']}:</ui:define>
    		<ui:param name="field" value="#{caseDataUA.detection}" /> 
		</s:decorate>

		<s:decorate template="/layout/displayfield.xhtml" rendered="#{caseDataUA.diagnosis!=null}">
    		<ui:define name="label">#{messages['TbField.DIAG_CONFIRMATION']}:</ui:define>
    		<ui:param name="field" value="#{caseDataUA.diagnosis}" />
		</s:decorate>

		<s:decorate template="/layout/displayfield.xhtml" rendered="#{caseDataUA.diagnosis!=null}">
    		<ui:define name="label">#{messages['TbField.REGISTRATION_CATEGORY']}:</ui:define>
    		<ui:param name="field" value="#{caseDataUA.registrationCategory}" />
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{not empty caseDataUA.riskClass}">
	    	<ui:define name="label">#{messages['RiskClassification']}:</ui:define>
	    	#{messages[caseDataUA.riskClass.key]}
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.infectionSite}">
    		<ui:define name="label">#{messages['InfectionSite']}:</ui:define>
    		#{messages[tbcase.infectionSite.key]}
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.extrapulmonaryType!=null}">
    		<ui:define name="label">#{messages['TbField.EXTRAPULMONARY_TYPES']}:</ui:define>
    		<h:outputText value="#{tbcase.extrapulmonaryType.shortName} - #{tbcase.extrapulmonaryType.name}" />
    		<h:outputText value="#{tbcase.extrapulmonaryType2.shortName} - #{tbcase.extrapulmonaryType2.name}" style="display:block;"/>
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.pulmonaryType!=null}">
    		<ui:define name="label">#{messages['TbField.PULMONARY_TYPES']}:</ui:define>
    		#{tbcase.pulmonaryType.shortName} - #{tbcase.pulmonaryType.name}
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.infectionSite!='EXTRAPULMONARY'}">
    		<ui:define name="label">#{messages['uk_UA.pulmonaryDestruction']}:</ui:define>
    		#{messages[caseDataUA.pulmonaryDestruction.key]}
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.infectionSite!='EXTRAPULMONARY'}">
    		<ui:define name="label">#{messages['uk_UA.pulmonaryMBT']}:</ui:define>
    		#{messages[caseDataUA.pulmonaryMBT.key]}
    		<s:fragment rendered="#{caseDataUA.mbtResult!=null}" >
    		<b>,   #{messages['uk_UA.ExtraOutcomeInfo']}:</b>
    		<h:outputText value="#{messages[caseDataUA.mbtResult.key]}" />
    		</s:fragment>
		</s:decorate>

		<s:fragment rendered="#{not empty prevTBTreatmentHome.treatments}">
		<h2>#{messages['cases.prevtreat']}</h2>
		<table width="100%" class="table1">
			<tr>
				<th rowspan="2">#{messages['cases.prevtreat.num']}
				</th>
				<th rowspan="2">#{messages['cases.prevtreat.date']}
				</th>
				<th colspan="#{prevTBTreatmentHome.substances.size}">
					#{messages['cases.prevtreat.regs']}
				</th>
				<th rowspan="2">#{messages['PrevTBTreatment.outcome']}
				</th>
			</tr>
			<tr>
			<a:repeat value="#{prevTBTreatmentHome.substances}" var="s">
				<th>#{s.abbrevName}
				</th>
			</a:repeat>
			</tr>
		<a:repeat value="#{prevTBTreatmentHome.treatments}" var="it">
			<tr>
				<td class="colcb">#{it.index}
				</td>
				<td class="colcb">
					#{it.prevTBTreatment.month+1}/#{it.prevTBTreatment.year}
				</td>
				<a:repeat value="#{it.items}" var="sub">
				<td class="colcb">
					<h:outputText value="x" rendered="#{sub.selected}" />
				</td>
				</a:repeat>
				<td class="colcb">
					#{messages[it.prevTBTreatment.outcome.key]}
				</td>
			</tr>
		</a:repeat>
		</table>
		</s:fragment>

	</td></tr>
	<s:fragment rendered="#{caseDataUAHome.colHospView >= 2}">
		<tr><td><h2>#{messages['uk_UA.newHospitalization']}:</h2></td></tr>
		<tr>
			<td>
			<s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.hospitalizationDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.hospitalizationDate2}" converter="localeDateConverter" />
		    </s:decorate>
		    </td><td>
		    <s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.dischargeDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.dischargeDate2}" converter="localeDateConverter" />
		    </s:decorate>
		    </td>
		</tr>
		</s:fragment>
		
		<s:fragment rendered="#{caseDataUAHome.colHospView >= 3}">
		<tr><td><h2>#{messages['uk_UA.newHospitalization']}:</h2></td></tr>
		<tr>
			<td>
			<s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.hospitalizationDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.hospitalizationDate3}" converter="localeDateConverter" />
		    </s:decorate>
		    </td><td>
		    <s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.dischargeDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.dischargeDate3}" converter="localeDateConverter" />
		    </s:decorate>
		    </td>
		</tr>
		</s:fragment>
		
		<s:fragment rendered="#{caseDataUAHome.colHospView >= 4}">
		<tr><td><h2>#{messages['uk_UA.newHospitalization']}:</h2></td></tr>
		<tr>
			<td>
			<s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.hospitalizationDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.hospitalizationDate4}" converter="localeDateConverter" />
		    </s:decorate>
		    </td><td>
		    <s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.dischargeDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.dischargeDate4}" converter="localeDateConverter" />
		    </s:decorate>
		    </td>
		</tr>
		</s:fragment>
		
		<s:fragment rendered="#{caseDataUAHome.colHospView == 5}">
		<tr><td><h2>#{messages['uk_UA.newHospitalization']}:</h2></td></tr>
		<tr>
			<td>
			<s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.hospitalizationDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.hospitalizationDate5}" converter="localeDateConverter" />
		    </s:decorate>
		    </td><td>
		    <s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['uk_UA.dischargeDate']}:</ui:define>
		    	<h:outputText value="#{caseDataUA.dischargeDate5}" converter="localeDateConverter" />
		    </s:decorate>
		    </td>
		</tr>
		</s:fragment>
	</table>
	</div>


	<div class="form-content">

		<h2>                 
			<s:link view="/cases/sideeffectsedt.xhtml" style="float:right;" rendered="#{caseHome.canEditCaseData}" 
				styleClass="button-alt" onclick="disableButton(this)">
				<f:param name="id" value="#{caseHome.id}" />
				<f:param name="idSideEffect" value="#{null}"/>
				<span>#{messages['form.new']}</span>
			</s:link>
			#{messages['cases.sideeffects']}
		</h2>
	
	<h:outputText value="#{messages['cases.details.noresultfound']}" styleClass="warn" rendered="#{empty sideEffectHome.results}" />
	<h:panelGroup id="sideeffects">
	<s:div styleClass="region3" rendered="#{empty sideEffectHome.results}"><div class="content">
		<h:outputText value="#{messages['cases.details.noresultfound']}" styleClass="warn" style="display:block;padding:4px"/>
	</div></s:div>
	
	<h:dataTable value="#{sideEffectHome.results}" var="it" styleClass="table1" rowClasses="lin1,lin2" rendered="#{not empty sideEffectHome.results}">
		<h:column>
			<f:facet name="header">
				<h:outputText value="#{messages['cases.sideeffects.desc']}" styleClass="collh" />
			</f:facet>
			<s:link value="#{it.sideEffect.value.name}" view="/cases/sideeffectsedt.xhtml" propagation="none" style="margin-right:20px;" rendered="#{caseHome.canEditCaseData}">
				<f:param name="id" value="#{tbcase.id}"/>
				<f:param name="idSideEffect" value="#{it.id}"/>
			</s:link>
			<s:fragment rendered="#{not empty it.sideEffect.complement}">
				<div style="display:inline-block">
					 - #{it.sideEffect.complement}
				</div>
			</s:fragment>
			<br />
			<b>#{messages['cases.sideeffects.month']}:</b> #{it.month}
			<br />
			<b><h:outputText value="#{messages['Substance']}:" rendered="#{not empty it.medicines}"/></b> #{it.medicines}
		</h:column>
	
		<h:column>
			<f:facet name="header">
				<h:outputText value="#{messages['global.comments']}" styleClass="collh" />
			</f:facet>
			#{it.comment}
		</h:column>
		
		<h:column>
			<f:facet name="header">
			
			</f:facet>
			<div style="float:right;fonst-size:9px">
				<h:commandLink value="#{messages['form.remove']}"
					onclick="if (confirm('#{messages['form.confirm_remove']}')) remSideEffect(#{it.id});return false;" 
				    rendered="#{caseHome.canEditCaseData}">
				</h:commandLink>
			</div>
		</h:column>
	</h:dataTable>
	
	</h:panelGroup>
	<a:jsFunction name="remSideEffect" action="#{sideEffectHome.remove}" reRender="sideeffects"  rendered="#{caseHome.canEditExams}">
		<a:actionparam name="param1" assignTo="#{sideEffectHome.id}" converter="javax.faces.Integer"/>
	</a:jsFunction>
	</div>
	
	</div>
		<s:fragment rendered="#{caseDataUA.causeChangeTreat != null}">
			<div class="spacer" />
			<table class="table2">
				<tr>
					<th align="center">
						<h:outputText value="#{messages['TbField.CAUSE_OF_CHANGE']}:"/>				
					</th>
				</tr>
				<tr>
					<td>
						<div class="content">
						#{caseDataUA.causeChangeTreat}
						</div>
					</td>
				</tr>
			</table>
		</s:fragment>
		
		<s:fragment rendered="#{caseDataUA.refuse2line}">
		<div class="spacer" />	
			<table class="table2">
				<tr>
					<td align="center">
						<h:outputText value="#{messages['cases.treatment.refusemed2line']}"/>				
					</td>
				</tr>
				
			</table>
		</s:fragment>
	<s:decorate template="/cases/comments.xhtml">
		<ui:param name="panel" value="data" />
	</s:decorate>
    
</ui:composition>
