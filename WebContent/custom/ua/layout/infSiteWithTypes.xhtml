<?xml version="1.0" encoding="UTF-8"?> 
<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:ui="http://java.sun.com/jsf/facelets"
                 xmlns:h="http://java.sun.com/jsf/html"
                 xmlns:f="http://java.sun.com/jsf/core"
 	  			xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich">

<script type="text/javascript">
<!--

	function showExtrapulmonary(cb) {
	  if (isExtrapulmonary(cb))
	  	jQuery('#extrapul').show(500);
	  else {
		  jQuery('#extrapul').hide(500);
		  clearField('#extrapul'); 
	  }
	  if (isPulmonary(cb)) 
		jQuery('#pulmonary').show(500);
	  else {
		  jQuery('#pulmonary').hide(500);
		  clearField('#pulmonary1'); 
	  }
	}
	function isExtrapulmonary(cb) {
	  	return ((cb.selectedIndex >=0) && ((cb.options[cb.selectedIndex].value == 'EXTRAPULMONARY') || (cb.options[cb.selectedIndex].value == 'BOTH')));
	}
	function isPulmonary(cb) {
		return ((cb.selectedIndex >=0) && ((cb.options[cb.selectedIndex].value == 'PULMONARY') || (cb.options[cb.selectedIndex].value == 'BOTH')));
	}
	function toggleYesNo(option, divname) {
		try {
			divname = eval(divname);
		} catch (e) {}
		if (option != '1')
			jQuery(divname).hide();
		else jQuery(divname).show();
	}
	function clearField(divId){
		jQuery(divId+" select").each(function(){
				this.selectedIndex = 0;
			});
	}
-->
</script>

	<s:decorate template="#{withValidate ? '/layout/edit.xhtml' : '/layout/display.xhtml'}">
    	<ui:define name="label">#{messages['InfectionSite']}:</ui:define>
    	<h:selectOneMenu id="infectsite" value="#{infSiteValue}" required="#{required}">
    		<s:selectItems var="it" value="#{infectionSites}" noSelectionLabel="-" label="#{messages[it.key]}" />
    		<s:convertEnum />
    	</h:selectOneMenu>
	</s:decorate>
	<rich:jQuery selector="#infectsite" query="change(function(){showExtrapulmonary(this); })" />

	<div id="extrapul" style="clear:both;">
		<s:decorate template="#{withValidate ? '/layout/edit.xhtml' : '/layout/display.xhtml'}">
    		<ui:define name="label">#{messages['TbField.EXTRAPULMONARY_TYPES']}:</ui:define>
    		<h:selectOneMenu value="#{extrapulTypeValue}" style="margin-right:4px;">
    			<s:selectItems var="it" value="#{fieldsQuery.extrapulmonaryTypes}" noSelectionLabel="-" label="#{it.shortName} - #{it.name}" />
    			<s:convertEntity />
    		</h:selectOneMenu>

    		<h:selectOneMenu value="#{extrapulType2Value}">
    			<s:selectItems var="it" value="#{fieldsQuery.extrapulmonaryTypes}" noSelectionLabel="-" label="#{it.shortName} - #{it.name}" />
    			<s:convertEntity />
    		</h:selectOneMenu>
		</s:decorate>
	</div>

	<div id="pulmonary" style="clear:both;">
		<div id="pulmonary1">
		<s:decorate template="#{withValidate ? '/layout/edit.xhtml' : '/layout/display.xhtml'}">
    		<ui:define name="label">#{messages['TbField.PULMONARY_TYPES']}:</ui:define>
    		<h:selectOneMenu value="#{pulTypeValue}" style="margin-right:4px;">
    			<s:selectItems var="it" value="#{fieldsQuery.pulmonaryTypes}" noSelectionLabel="-" label="#{it.shortName} - #{it.name}" />
    			<s:convertEntity />
    		</h:selectOneMenu>
		</s:decorate>
		</div>
		
		<s:fragment rendered="#{destructAndMBT}">
			<s:decorate template="#{withValidate ? '/layout/edit.xhtml' : '/layout/display.xhtml'}">
	    		<ui:define name="label">#{messages['uk_UA.pulmonaryDestruction']}:</ui:define>
	    		<h:selectOneMenu value="#{caseDataUA.pulmonaryDestruction}" style="margin-right:4px;">
	    			<s:selectItems var="it" value="#{yesNoList}" noSelectionLabel="-" label="#{messages[it.key]}" />
	    			<s:convertEnum />
	    		</h:selectOneMenu>
			</s:decorate>
	
			<s:decorate template="#{withValidate ? '/layout/edit.xhtml' : '/layout/display.xhtml'}">
	    		<ui:define name="label">#{messages['uk_UA.pulmonaryMBT']}:</ui:define>
	    		<h:selectOneMenu value="#{caseDataUA.pulmonaryMBT}" style="margin-right:4px;" onchange="toggleYesNo(this.selectedIndex, '#mbtdiv');">
	    			<s:selectItems var="it" value="#{yesNoList}" noSelectionLabel="-" label="#{messages[it.key]}" />
	    			<s:convertEnum />
	    		</h:selectOneMenu>
	    		<div id="mbtdiv" style="#{caseDataUA.pulmonaryMBT=='YES'?'':'display:none'}">
	    		#{messages['uk_UA.ExtraOutcomeInfo']}:
	    		<h:selectOneMenu value="#{caseDataUA.mbtResult}" rendered="#{tbcase.classification != 'DRTB'}">
	    			<s:selectItems var="s" value="#{globalLists_ua.mbtResults}" noSelectionLabel="-" label="#{messages[s.key]}" />
	    			<s:convertEnum />
	    		</h:selectOneMenu>
	    		
	    		<h:selectOneMenu value="#{caseDataUA.mbtResult}" rendered="#{tbcase.classification == 'DRTB'}">
	    			<s:selectItems var="s" value="#{globalLists_ua.mbtResultsDRTB}" noSelectionLabel="-" label="#{messages[s.key]}" />
	    			<s:convertEnum />
	    		</h:selectOneMenu>
	    		</div>
			</s:decorate>
		</s:fragment>
		
	</div>
	<rich:jQuery selector="#infectsite" query="each(function(){ if (!isExtrapulmonary(this)) {jQuery('#extrapul').hide(); }})" />
	<rich:jQuery selector="#infectsite" query="each(function(){ if (!isPulmonary(this)) {jQuery('#pulmonary').hide(); }})" />
	

</ui:composition>