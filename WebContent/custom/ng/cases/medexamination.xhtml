<?xml version="1.0" encoding="UTF-8"?> 
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
 	  			xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich">

	<div class="spacer" />
	<s:link view="/custom/ng/cases/edtmedexam.xhtml" style="float:right;" rendered="#{caseHome.canEditCaseData}">
		<f:param name="id" value="#{tbcase.id}"/>
		<f:param name="examid" value="#{null}"/>
		<span>#{messages['cases.details.newresult']}</span>
	</s:link>

	<h:panelGroup id="medexamtbl">
	<h:outputText value="#{messages['cases.details.noresultfound']}" styleClass="error" rendered="#{empty medicalExaminationNGHome.allResults}" />

	<!-- <h:dataTable id="medexamtbl" value="#{medicalExaminationHome.allResults}" var="r" rendered="#{not empty medicalExaminationHome.allResults}" width="100%">
		<h:column> -->
	<ui:repeat var="r" value="#{medicalExaminationNGHome.allResults}">
		<div class="spacer" />
		
		<div class="region1">
			<div class="header">
			<div style="float:right;">
				<s:link value="#{messages['form.edit']}" view="/custom/ng/cases/edtmedexam.xhtml" propagation="none" style="margin-right:20px;" rendered="#{caseHome.canEditCaseData}">
					<f:param name="id" value="#{tbcase.id}"/>
					<f:param name="examid" value="#{r.id}"/>
				</s:link>
				<h:commandLink value="#{messages['form.remove']}" onclick="if (confirm('#{messages['form.confirm_remove']}')) remMedExam(#{r.id}, #{medicalExaminationNGHome.lastResult});return false;" 
				      rendered="#{caseHome.canEditCaseData}">
				</h:commandLink>
			</div>
			<!-- <div class="name2">#{messages['cases.details.date']}: </div> --> 
			<h2><h:outputText value="#{r.date}" converter="localeDateConverter" /></h2>
			</div>
			
				<div class="content">
	
		<ui:param name="showfooter" value="0" />

		<a:jsFunction name="remMedExam" action="#{medicalExaminationNGHome.remove}" reRender="medexamtbl" ajaxSingle="true" rendered="#{caseHome.canEditCaseData}">
			<a:actionparam name="param1" assignTo="#{medicalExaminationNGHome.id}" converter="javax.faces.Integer"/>
		</a:jsFunction>


		<table width="100%" style="border-collapse:collapse;">
		<tr><td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['cases.details.date']}:</ui:define>
					<h:outputText value="#{r.date}" converter="localeDateConverter" />
				</s:decorate>
			</td>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedAppointmentType']}:</ui:define>
					#{messages[r.appointmentType.key]}
				</s:decorate>
			</td></tr>
		<tr>
			<td>
			<s:decorate template="/layout/display.xhtml">
				<ui:define name="label">#{messages['MedicalExamination.weight']}:</ui:define>
				<h:outputText value="#{r.weight}" >
					<f:convertNumber pattern="#,###,##0.00"/>
				</h:outputText>#{messages['MedicalExamination.weight.unit']}
			</s:decorate>
		    </td>
		    <td>
			<s:decorate template="/layout/display.xhtml">
				<ui:define name="label">#{messages['MedicalExamination.height']}:</ui:define>
				<h:outputText value="#{r.height}" >
					<f:convertNumber pattern="#,###,##0.00"/>
				</h:outputText>#{messages['MedicalExamination.height.unit']}
			</s:decorate>		
		   </td>
		   <td>
			<s:decorate template="/layout/display.xhtml">
				<ui:define name="label">#{messages['MedicalExamination.BMI']}:</ui:define>
				<h:outputText value="#{r.BMI}" >
					<f:convertNumber pattern="#,###,##0.000"/>
				</h:outputText>
			</s:decorate>
		   </td>
		</tr>
		<tr><td>
			<s:decorate template="/layout/display.xhtml">
				<ui:define name="label">#{messages['MedicalExamination.usingPrescMedicines']}:</ui:define>
				<h:outputText value="#{r.usingPrescMedicines}"/>
			</s:decorate>
		</td>
		<td>
			<s:decorate template="/layout/display.xhtml" rendered="#{not empty r.reasonNotUsingPrescMedicines}">
				<ui:define name="label">#{messages['MedicalExamination.reasonNotUsingPrescMedicines']}:</ui:define>
				<h:outputText value="#{r.reasonNotUsingPrescMedicines}"/>
			</s:decorate>		
		</td></tr>
		<tr>
		<td>
		<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedicalExamination.responsible']}:</ui:define>
					<h:outputText value="#{r.responsible}"/>
				</s:decorate>
		</td>
		</tr>
		<tr><td>
			<s:decorate template="/layout/display.xhtml">
				<ui:define name="label">#{messages['MedicalExamination.nutrition']}:</ui:define>
				<h:outputText value="#{r.nutrtnSupport}"/>
			</s:decorate>	
		</td>
		</tr>
		<tr>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedicalExamination.ReferredFrom']}:</ui:define>
					<h:outputText value="#{r.patientRefBy}"/>
				</s:decorate>
			</td>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedicalExamination.RefByUnit']}:</ui:define>
					<h:outputText value="#{r.referredByUnitName}"/>
				</s:decorate>
			</td>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedicalExamination.RefByDate']}:</ui:define>
					<h:outputText value="#{r.refByDate}"/>
				</s:decorate>
			</td>
		</tr>
		
		<tr>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedicalExamination.RefToUnit']}:</ui:define>
					<h:outputText value="#{r.referredToUnitName}"/>
				</s:decorate>
			</td>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedicalExamination.RefToDate']}:</ui:define>
					<h:outputText value="#{r.refToDate}"/>
				</s:decorate>
			</td>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedicalExamination.RefReason']}:</ui:define>
					<h:outputText value="#{r.sideeffect}"/>
				</s:decorate>
			</td>
		</tr>
		
		<s:fragment rendered="#{not empty r.comments}">
		<tr><td>
			<s:decorate template="/layout/display.xhtml">
				<ui:define name="label">#{messages['global.comments']}:</ui:define>
				#{r.comments}
			</s:decorate>
		</td></tr>
		</s:fragment>

		</table>
		</div>
		</div>
    </ui:repeat>
    </h:panelGroup>
    
<rich:modalPanel id="medexamdlg"  
            height="400" width="450" zindex="2000">
	<f:facet name="header">
	<h:panelGroup id="resistpnl">
	<table width="100%" style="border-collapse:collapse;">
		<tr><td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['cases.details.date']}:</ui:define>
					<h:outputText value="#{r.date}" converter="localeDateConverter" />
				</s:decorate>
			</td>
			<td>
				<s:decorate template="/layout/display.xhtml">
					<ui:define name="label">#{messages['MedAppointmentType']}:</ui:define>
					#{messages[r.appointmentType.key]}
				</s:decorate>
			</td></tr>
			</table>
	<a:commandLink oncomplete="hideAllMedExamDetails();" 
				styleClass="button-alt" >
				<span>#{messages['form.cancel']}</span>
	</a:commandLink>
	</h:panelGroup>
	 </f:facet></rich:modalPanel>

    <s:decorate template="/cases/comments.xhtml">
		<ui:param name="panel" value="data" />
	</s:decorate>
</ui:composition>
