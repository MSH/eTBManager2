<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:a="https://ajax4jsf.dev.java.net/ajax"
	xmlns:rich="http://richfaces.ajax4jsf.org/rich"
	template="/layout/template_new.xhtml">

<ui:param name="title" value="#{messages['cases.searchresult']}" />
<ui:param name="topmenu" value="0" />
<ui:param name="left" value="0" />

	<ui:define name="naveg">
		<s:link value="#{messages['cases']}" view="/cases/index.html"
			propagation="none" />
		<div class="item selected">
			<s:link value="#{title}" propagation="none" />
		</div>
	</ui:define>

	<ui:define name="left">
	</ui:define>

	<ui:define name="content">
		<h1>#{title}</h1>
		<h:form id="listCases">

			<table width="100%">
				<tr>
					<td></td>
					<td>
						<h:commandLink styleClass="button-alt"
							onclick="Richfaces.showModalPanel('filtersdlg');return false;"
							style="float:right;" rendered="#{casesAZ.eidssSearch != true}">
							<span>#{messages['cases.newsearch']}</span>
						</h:commandLink>
						<h:commandLink styleClass="button-alt"
							onclick="Richfaces.showModalPanel('filtersdlgeidss');return false;"
							style="float:right;" rendered="#{casesAZ.eidssSearch == true}">
							<span>#{messages['cases.newsearch']}</span>
						</h:commandLink>
					</td>
				</tr>
			</table>

			<s:decorate template="/layout/naveg.xhtml">
				<ui:param name="list" value="#{casesAZ}" />

				<h:panelGroup id="res">
					<table id="tblres" width="100%" class="table1">
						<tr>
							<th class="searchtitle">
							<ui:fragment rendered='#{!casesAZ.notBindedEIDSS}'>
								<div style="padding: 4px;">
									<a:commandLink value="#{messages['Patient.caseNumber']}"
										onclick="changeOrder(0); return false;" />
									<br /> <br />
									<a:commandLink value="#{messages['Gender']}"
										onclick="changeOrder(1); return false;" />
								</div>
								</ui:fragment>
							<ui:fragment rendered='#{casesAZ.notBindedEIDSS}'>
								<div style="padding: 4px;">
									<a:commandLink value="#{messages['Gender']}"
										onclick="changeOrder(1); return false;" />
								</div>
								</ui:fragment>
								</th>
							<th class="searchtitle">
							<h:outputText value="#{messages['cases.patientdata']}"/>
									
							<br/>
								<div style="padding: 4px; font-size:10px;">
									
									<a:commandLink value="#{messages['Patient.name']}"
										onclick="changeOrder(3);return false;" />
									<br />
									#{messages['az_EIDSS_Year_Of_Birth']}<br/>
									<a:commandLink value="#{messages['TbCase.patientAge']}"
										onclick="changeOrder(4);return false;" />
										<br/>
									<a:commandLink value="#{levelInfo.nameLevel1}"
											onclick="changeOrder(6);return false;" />
										-
										<a:commandLink value="#{levelInfo.nameLevel2}"
											onclick="changeOrder(7);return false;" />
										(#{messages['Address']}) 
								</div></th>
							<s:fragment>
								<th class="searchtitle">
								
										<h:outputText value="#{messages['ExportContent.CASEDATA']}"/>
										<div style="padding: 4px; font-size:10px;">
											<a:commandLink value="#{messages['CaseClassification']}"
												onclick="changeOrder(2);return false;" />
											<br /> 
											<a:commandLink
												value="#{messages['cases.casesearching.treatlen']}"
												onclick="changeOrder(10);return false;" />
											<br />
											<a:commandLink value="#{messages['TbCase.notificationUnit']}"
												onclick="changeOrder(5);return false;" />
											<br /> 
											
											<a:commandLink value="#{messages['CaseState']}"
												onclick="changeOrder(8);return false;" />
										</div>
									<!--<ui:fragment rendered='#{casesAZ.notBindedEIDSS}'>
										<div style="padding: 4px;"><b>#{messages['az_EIDSS_Note']}</b></div>
										<div style="padding: 4px;"><b>#{messages['az_EIDSS_Notify_LPU']}/</b></div>
										<div style="padding: 4px;"><b>#{messages['az_EIDSS_Address']}</b>
										</div>
									</ui:fragment>-->
									</th>
							</s:fragment>
							<th class="searchtitle">
								<h:outputText value="#{messages['TbCase.eidsscomment']}"/>
								 <!-- 
								<ui:fragment
									rendered='#{!casesAZ.notBindedEIDSS}'>
									
									<div style="padding: 4px;">
										<a:commandLink value="#{messages['TbCase.registrationDate']}"
											onclick="changeOrder(9);return false;" />
										<br /> 
										<a:commandLink value="#{messages['ValidationState']}"
											onclick="changeOrder(11);return false;" />
									</div>
								</ui:fragment> <ui:fragment rendered='#{casesAZ.notBindedEIDSS}'>
									<div style="padding: 4px;">
										<a:commandLink value="#{messages['az_EIDSS_REGDATE']}"
											onclick="changeOrder(9);return false;" />
									</div>
								</ui:fragment>
								 --> 
								</th>
						</tr>
						<ui:repeat value="#{casesAZ.resultList}" var="it">
							<tr>
								<td width="90px" align="center"><s:link
										value="#{it.displayCaseNumber}"
										view="/cases/casedata.xhtml">
										<f:param name="id" value="#{it.tbcase.id}" />
									</s:link> <br /> <s:link view="/cases/casedata.xhtml"
										styleClass="#{it.patient.gender=='MALE'?'male-icon':'female-icon'}"
										style="float:none">
										<f:param name="id" value="#{it.tbcase.id}" />
									</s:link></td>
								<td style="color:#069;">
										<b>#{caseAZHome.getRightPatientName(it.tbcase)}</b><br/>
										#{caseAZHome.getYearOfBirth(it.tbcase)} #{messages['az_EIDSS_Year_Of_Birth.short']} (<h:outputText value="#{caseAZHome.reGetTbCase(it.tbcase).patient.birthDate}" converter="localeDateConverter"/>), #{caseAZHome.reGetTbCase(it.tbcase).age} #{messages['az_EIDSS_years']}<br/>
										<ui:fragment rendered='#{!casesAZ.notBindedEIDSS}'>
										<div style="padding-top: 6px;padding-bottom: 6px;">
										<sub>#{messages['Address.regist']}:</sub><br/>
										<h:outputText value="#{caseAZHome.reGetTbCase(it.tbcase).notifAddress.address} #{caseAZHome.reGetTbCase(it.tbcase).notifAddress.complement}" style="padding-left: 10px;" /> <br/>
										<sub>#{messages['Address.live']}:</sub><br/>
										<h:outputText value="#{caseAZHome.reGetTbCase(it.tbcase).currentAddress.address} #{caseAZHome.reGetTbCase(it.tbcase).currentAddress.complement}" style="padding-left: 10px;" />
										</div>	
										</ui:fragment>
										#{messages['az_AZ.case.unicalID']}:
										<b>#{caseAZHome.reGetTbCase(it.tbcase).unicalID!=null ? caseAZHome.reGetTbCase(it.tbcase).unicalID : 'XXXXXXXX'}</b>
								</td>
								<s:fragment>
									<td>
									  
									     <b>#{messages[caseAZHome.reGetTbCase(it.tbcase).classification.key]} -  <h:outputText value=" #{messages[caseAZHome.reGetTbCase(it.tbcase).state.key]}"
												style="color:SaddleBrown;" rendered="#{caseAZHome.reGetTbCase(it.tbcase).state != 'ONTREATMENT'}"/>
											<s:fragment rendered="#{caseAZHome.reGetTbCase(it.tbcase).state == 'ONTREATMENT'}">
											<h:outputText value=" #{messages['CaseState.ONTREATMENT']} #{messages['from']} " style="color:SaddleBrown;"/>
											
											<h:outputText value="#{caseAZHome.verifyDateIniTreat(it.tbcase)}"
												style="color:SaddleBrown;" escape="false"/>
												
											</s:fragment>
										 </b>
									     <br/>
									     #{messages['PatientType']}: #{messages[caseAZHome.reGetTbCase(it.tbcase).patientType.key]} <br/>
									     <h:outputText value="#{messages['TbCase.diagnosisDate']}: "/><h:outputText value="#{caseAZHome.reGetTbCase(it.tbcase).diagnosisDate}" converter="localeDateConverter"/> <br/>
									     #{messages['User.state']}: #{messages[caseAZHome.reGetTbCase(it.tbcase).diagnosisType.key]}<br/>
									     #{messages['DiagnosisType']}: #{messages[caseAZHome.reGetTbCase(it.tbcase).infectionSite.key]}<br/>
									     <b><h:outputText value="#{caseAZHome.reGetTbCase(it.tbcase).ownerUnit.name}" rendered="#{caseAZHome.reGetTbCase(it.tbcase).ownerUnit!=NULL}"/> </b><br /> 
										 <h:outputText
											value="#{it.adminUnitDisplay}" style="font-size:10px;" />
										<br/>
										<s:fragment rendered="#{caseAZHome.reGetTbCase(it.tbcase).EIDSSComment!=NULL}">
										 <h:outputText value="#{messages['Accept']} #{caseAZHome.reGetTbCase(it.tbcase).systemDate==null?'XX.XX.XXXX':''}" style="color:Firebrick;" />
										 <h:outputText value="#{caseAZHome.reGetTbCase(it.tbcase).systemDate}"  style="color:Firebrick;" converter="localeDateConverter" rendered="#{caseAZHome.reGetTbCase(it.tbcase).systemDate!=null}"/>
										 <br/>
										</s:fragment>
										  <h:outputText style="color:gray;" 
											value="#{messages['TbCase.referToOtherTBUnit']}  #{messages[caseAZHome.reGetTbCase(it.tbcase).referToOtherTBUnit?'global.no':'global.yes']}"/>
										
									</td>
								</s:fragment>
								<td style="border-left: 1px solid #E0E0E0;color:#45793D;">
									<h:outputText value="#{caseAZHome.getEIDSSBlock(it.tbcase)}" escape="false"/>
								</td>
							</tr>
						</ui:repeat>
					</table>
				</h:panelGroup>
			</s:decorate>

			<rich:jQuery selector="#tblres tr:odd" query="addClass('lin1')" />
			<rich:jQuery selector="#tblres tr:even" query="addClass('lin2')" />

			<a:jsFunction name="changeOrder" reRender="listCases"
				ajaxSingle="true">
				<a:actionparam name="param1" assignTo="#{caseFilters.newOrder}"
					converter="javax.faces.Integer" />
			</a:jsFunction>
		</h:form>



		<rich:modalPanel id="filtersdlg" width="680" top="100" zindex="2000" autosized="true">
			<f:facet name="header">
				#{messages['cases.newsearch']}
			</f:facet>
			<h:form>
				<a:region>
					<table width="99%">
						<tr>
							<td colspan="2">
								<ui:include src="#{wspage['/cases/searchfilters.xhtml']}" />
							</td>
						</tr>
						<tr>
							<td>
								<ui:include src="/layout/waitstatus.xhtml" />
							</td>
						</tr>
					</table>

					<div class="button-bar">
						<a:commandLink id="btnsearch" action="#{casesAZ.refresh}" styleClass="button" reRender="listCases" 
										onclick="if (!disableButton(this)) return false;if (!validateFilters()) {enableButton();return false}"
										oncomplete="enableButton();this.disabled=false;Richfaces.hideModalPanel('filtersdlg');return false;">
							<a:actionparam assignTo="#{casesAZ.searchCriteria}"	value="#{'CUSTOM_FILTER'}" />
							<a:actionparam assignTo="#{eidssFilters.search}" value="false" />
							<span>#{messages['form.search']}</span>
						</a:commandLink>
						<s:link
							onclick="enableButton();Richfaces.hideModalPanel('filtersdlg');return false;"
							styleClass="button-alt">
							<span>#{messages['form.cancel']}</span>
						</s:link>
					</div>
				</a:region>
				<rich:hotKey selector="#tblfilters input,select" key="return"
					handler="#{rich:element('btnsearch')}.click();" />
			</h:form>
		</rich:modalPanel>


		<rich:modalPanel id="filtersdlgeidss" width="1000" top="100" zindex="2000" autosized="true">
			<f:facet name="header">
				#{messages['cases.newsearch']}
			</f:facet>
			<h:form>
				<a:region>
					<table width="99%">
						<tr>
							<td colspan="2">
								<ui:include src="#{wspage['/cases/eidssfilters.xhtml']}" />
							</td>
						</tr>
						<tr>
							<td>
								<ui:include src="/layout/waitstatus.xhtml" />
							</td>
						</tr>
					</table>

					<div class="button-bar">
						<a:commandLink id="btnsearch" action="#{casesAZ.refresh}" styleClass="button" reRender="listCases" 
										onclick="if (!disableButton(this)) return false;if (!validateFilters()) {enableButton();return false}"
										oncomplete="enableButton(); this.disabled=false; Richfaces.hideModalPanel('filtersdlgeidss'); return false;">
							<a:actionparam assignTo="#{casesAZ.searchCriteria}"	value="#{'CUSTOM_FILTER'}" />
							<a:actionparam assignTo="#{eidssFilters.search}" value="true" />
							<span>#{messages['form.search']}</span>
						</a:commandLink>
						<s:link
							onclick="enableButton();Richfaces.hideModalPanel('filtersdlgeidss');return false;"
							styleClass="button-alt">
							<span>#{messages['form.cancel']}</span>
						</s:link>
					</div>
				</a:region>
				<rich:hotKey selector="#tblfilters input,select" key="return"
					handler="#{rich:element('btnsearch')}.click();" />
			</h:form>
		</rich:modalPanel>
	</ui:define>

</ui:composition>
