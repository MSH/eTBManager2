<?xml version="1.0" encoding="UTF-8"?> 
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
 	  			xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich">
<h:form>
<ui:param name="labelstyle" value="text-align:left;width:200px;" />
	<s:link view="/custom/az/cases/caseedt.xhtml" style="margin-bottom:-7px;" rendered="#{caseHome.canEditCaseData}" styleClass="button-alt">
		<f:param name="id" value="#{caseHome.id}" />
		<span>#{messages['form.edit']}</span>
	</s:link>
	<div class="form1">
	<s:fragment rendered="#{caseAZHome.canEditCloseCaseData}">
	<div class="form-content">                 
	<s:link view="/custom/az/cases/caseedt.xhtml" style="float:right;" rendered="#{caseAZHome.canEditCloseCaseData}" styleClass="button-alt">
		<f:param name="id" value="#{caseHome.id}" />
		<span>#{messages['form.edit']}</span>
	</s:link>
	<h2>#{messages['TbCase.toThirdCategory.edt']}</h2>
	<h:outputText value="#{messages['TbCase.toThirdCategory.no']}" styleClass="warn" rendered="#{!tbcase.toThirdCategory}" />
	
		<s:fragment rendered="#{tbcase.toThirdCategory}">	   	
			<s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['TbCase.toThirdCategory.iniDate']}:</ui:define>
    			<h:outputText id="dt" value="#{tbcase.thirdCatPeriod.iniDate}" converter="localeDateConverter"/>
    		</s:decorate>
		
			<s:decorate template="/layout/display.xhtml" >
		    	<ui:define name="label">#{messages['TbCase.toThirdCategory.endDate']}:</ui:define>
		    	<h:outputText id="dt" value="#{tbcase.thirdCatPeriod.endDate}" converter="localeDateConverter"/> 
		    </s:decorate>	
		</s:fragment>
		
	</div>
	</s:fragment>
	<div class="form-content">                 
	
	<h2>#{messages['cases.patientdata']}</h2>
	<div style="position:absolute; width:330px; left:440px;">
		<table style="border: 1px solid #FFFFFF;">
		<tr>
		<th bgcolor="#afcfc1" style="color:#FFFFFF;">
		#{messages['TbCase.eidsscomment']}
		</th>
		</tr>
		<tr>
			<td>
				<h:outputText value="#{caseAZHome.getEIDSSBlock(tbcase)}" escape="false" style="color:#45793D;"/>
			</td>
		</tr>
		</table>
	</div>
	<table style="border-collapse:collapse;width:100%;" >
	<tr>
	<td>
		<s:decorate template="/layout/display.xhtml">
	    	<ui:define name="label">#{messages['Patient.securityNumber']}:</ui:define>
			#{caseAZHome.getRegistrationNumber()}
		</s:decorate>
	</td></tr>
	<tr><td>
	
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['Gender']}:</ui:define>
		#{messages[tbcase.patient.gender.key]}
	</s:decorate>
	
	</td></tr>
	<tr>
	<td>
	
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['Patient.birthDate']}:</ui:define>
    	<h:outputText id="dt" value="#{tbcase.patient.birthDate}" converter="localeDateConverter"/>
	</s:decorate>
	
	</td></tr>
	<tr><td>
	
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['TbCase.patientAge']}:</ui:define>
    	<h:outputText value="#{tbcase.patientAge}" style="padding-right:4px;" />
	</s:decorate>

	</td></tr>
    <tr><td colspan="2">
		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.nationality != null}">
    		<ui:define name="label">#{messages['Nationality']}:</ui:define>
    		<h:outputText value="#{messages[tbcase.nationality.key]}" />
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.patient.motherName}">
    		<ui:define name="label">#{messages['Patient.motherName']}:</ui:define>
    		#{tbcase.patient.motherName}
    	</s:decorate>
    </td></tr>
    <s:fragment rendered="#{not tbcase.notifAddress.emptyy}">
    <tr><td colspan="2">
    	<div class="paragraph">#{messages['cases.details.addressnotif.AZ']}</div>
	
		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['Address.address']}:</ui:define>
    		#{tbcase.notifAddress.address}
    		<br/>
    		#{tbcase.notifAddress.complement}  
    		 ( #{messages[tbcase.notifAddress.localityType.key]})	
    	</s:decorate>
		<s:decorate template="/layout/display.xhtml" >
			<ui:define name="label">#{messages['CountryStructure.level1']}:</ui:define>
			#{tbcase.notifAddress.adminUnit.name}
		</s:decorate> 
	</td>
	</tr>
	</s:fragment>
	
	<s:fragment rendered="#{not tbcase.currentAddress.emptyy}">
    <tr><td colspan="2">
    	<div class="paragraph">#{messages['cases.details.addresscurr']}</div>
	
		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['Address.address']}:</ui:define>
    		#{tbcase.currentAddress.address}
    		<br/>
    		#{tbcase.currentAddress.complement}    		
    	</s:decorate>
    	
 		<s:decorate template="/layout/audisplay.xhtml">
			<ui:param name="adminunit" value="#{tbcase.currentAddress.adminUnit}" />
		</s:decorate>
	</td></tr>
	</s:fragment>
	
	<tr><td>
		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.mobileNumber}">
    		<ui:define name="label">#{messages['TbCase.phoneNumber']}:</ui:define>
    		#{tbcase.phoneNumber}
		</s:decorate>
	</td>
	<td>
		<s:decorate template="/layout/display.xhtml" rendered="#{not empty tbcase.mobileNumber}">
    		<ui:define name="label">#{messages['TbCase.mobileNumber']}:</ui:define>
    		#{tbcase.mobileNumber}
		</s:decorate>
	</td></tr>
	
	<tr>
		<td>
		    <s:decorate template="/layout/displayfield.xhtml" >
		    	<ui:define name="label">#{messages['az_AZ.case.maritalStatus']}:</ui:define>
		    	<ui:param name="field" value="#{tbcase.maritalStatus}" />
		    </s:decorate>
		</td>
	</tr>
	<tr>
		<td>
		    <s:decorate template="/layout/displayfield.xhtml" >
		    	<ui:define name="label">#{messages['az_AZ.case.educationalDegree']}:</ui:define>
		    	<ui:param name="field" value="#{tbcase.educationalDegree}" />
		    </s:decorate>
		</td>
	</tr>
	<tr>
		<td>
	<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['az_AZ.case.doctor']}:</ui:define>
    		<h:outputText value="#{tbcase.doctor}"/> 
    	</s:decorate>
    	</td>
	</tr>
	<s:fragment rendered="#{userAZControl.canViewJusticeFields()}">
    <tr><td>
    		<table style="border: 1px solid #FFFFFF;">
		<tr>
		<th bgcolor="#afcfc1" style="color:#FFFFFF;">
		#{messages['cases.details.otherinfo']}
		</th>
		</tr>
		<tr><td>
    	<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['az_AZ.case.numberOfImprisonments']}:</ui:define>
    		#{tbcase.numberOfImprisonments}
    	</s:decorate>	

    	<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['az_AZ.case.inprisonIniDate']}:</ui:define>
    		<h:outputText id="dt" value="#{tbcase.inprisonIniDate}" converter="localeDateConverter"/>
    	</s:decorate>	

    	<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['az_AZ.case.inprisonEndDate']}:</ui:define>
    		<h:outputText id="dt" value="#{tbcase.inprisonEndDate}" converter="localeDateConverter"/>
    	</s:decorate>	
    	
    	</td></tr>
  </table>
    </td></tr>
	</s:fragment>
	</table>
	</div>
		

	<div class="form-content">
	<h2>#{messages['cases.generaldata']}</h2>
	
	<table style="border-collapse:collapse;width:100%">
	<tr><td>
	<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.notificationUnit!=null}">
    	<ui:define name="label">#{messages['az_AZ.TbCase.notificationUnit']}:</ui:define>
    	#{tbcase.notificationUnit.name}
	</s:decorate>

	</td></tr>
	<tr><td>
	<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.referToTBUnit!=null}">
    	<ui:define name="label">#{messages['TbCase.referUnit']}:</ui:define>
    	#{tbcase.referToTBUnit.name}
	</s:decorate>
	</td></tr>
	<tr><td>
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['TbCase.registrationDate']}:</ui:define>
    	<h:outputText id="dt" value="#{tbcase.registrationDate}" converter="localeDateConverter"/>
	</s:decorate>
	
	</td></tr>
	<tr><td>
	<s:decorate template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['TbCase.diagnosisDate']}:</ui:define>
    	<h:outputText id="dt" value="#{tbcase.diagnosisDate}" converter="localeDateConverter"/>
	</s:decorate>
	
	</td><td>
	
	<s:decorate template="/layout/display.xhtml">
		<ui:define name="label">#{messages['DiagnosisType']}:</ui:define>
		#{messages[tbcase.diagnosisType.key]}
	</s:decorate>
	</td></tr>
	<tr>
	<td>
	<s:decorate id="dt" template="/layout/display.xhtml">
    	<ui:define name="label">#{messages['TbCase.iniTreatmentDate']}:</ui:define>
    	<h:outputText id="dt" value="#{tbcase.treatmentPeriod.iniDate}" converter="localeDateConverter"/>
	</s:decorate>
	</td></tr>
	
	<tr><td	colspan="2">
		<s:decorate template="/layout/display.xhtml" >
			<ui:define name="label">#{messages['DrugResistanceType']}</ui:define>
			#{messages[tbcase.drugResistanceType.key]}
		</s:decorate>
		
		<s:decorate template="/layout/display.xhtml" >
    		<ui:define name="label">#{messages['InfectionSite']}:</ui:define>
    		#{messages[tbcase.infectionSite.key]}
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.pulmonaryType!=null}">
    		<ui:define name="label">#{messages['TbField.PULMONARY_TYPES']}:</ui:define>
    		#{tbcase.pulmonaryType}
		</s:decorate>

		<s:decorate template="/layout/display.xhtml" rendered="#{tbcase.extrapulmonaryType!=null}">
    		<ui:define name="label">#{messages['TbField.EXTRAPULMONARY_TYPES']}:</ui:define>
    		#{tbcase.extrapulmonaryType} <h:outputText value="/ #{tbcase.extrapulmonaryType2}" />
		</s:decorate>

		<s:decorate template="/layout/display.xhtml">
    		<ui:define name="label">#{messages['PatientType']}:</ui:define>
    		#{messages[tbcase.patientType.key]}
		</s:decorate>

		<s:decorate template="/layout/display.xhtml">
			<ui:define name="label">#{messages['az_AZ.CaseFindingStrategy']}:</ui:define>
			#{messages[tbcase.caseFindingStrategy.key]}
		</s:decorate>

		<h2>#{messages['TbField.SEVERITY_MARKS']}</h2>
		<h:outputText value="#{messages['cases.details.noresultfound']}" styleClass="warn" rendered="#{empty caseSeverityMarksHome.severityMarks}" />
		<h:dataTable value="#{caseSeverityMarksHome.severityMarks}" var="it" style="clear:left;width:100%;border-collapse:collapse;"
			rendered="#{not empty caseSeverityMarksHome.severityMarks}" >
			<h:column>
   				<div class="#{it.checked?'checked-icon':'unchecked-icon'}" />
				#{it.severityMark.name}
			</h:column>
		
			<h:column>
				#{it.comments}
			</h:column>
		</h:dataTable>


		<s:fragment rendered="#{not empty prevTBTreatmentHome.treatments}">
		<div class="paragraph">#{messages['cases.prevtreat']}</div>
		<table width="100%" class="table1">
			<tr>
				<th rowspan="2">#{messages['cases.prevtreat.num']}
				</th>
				<th rowspan="2">#{messages['cases.prevtreat.date']}
				</th>
				<th colspan="#{prevTBTreatmentHome.substances.size}">
					#{messages['cases.prevtreat.meds']}
				</th>
				<th rowspan="2">#{messages['PrevTBTreatment.outcome']}
				</th>
			</tr>
			<tr>
			<a:repeat value="#{prevTBTreatmentHome.substances}" var="s">
				<th>#{s.abbrevName}
				</th>
			</a:repeat>
			</tr>
		<a:repeat value="#{prevTBTreatmentHome.treatments}" var="it">
			<tr>
				<td class="colcb">#{it.index}
				</td>
				<td class="colcb">
					#{it.prevTBTreatment.month+1}/#{it.prevTBTreatment.year}
				</td>
				<a:repeat value="#{it.items}" var="sub">
				<td class="colcb">
					<h:outputText value="x" rendered="#{sub.selected}" />
				</td>
				</a:repeat>
				<td class="colcb">
					#{messages[it.prevTBTreatment.outcome.key]}
				</td>
			</tr>
		</a:repeat>
		</table>
		</s:fragment>

	</td></tr>
	</table>
	</div>

	<s:decorate template="/cases/comments.xhtml">
		<ui:param name="panel" value="data" />
	</s:decorate>
	
	</div>
</h:form>
</ui:composition>
