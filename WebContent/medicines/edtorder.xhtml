<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      template="..#{workspaceViewService.templatePage}">

<ui:param name="title" value="#{messages['medicines.orders.new']}" />

<ui:param name="topmenu" value="1" />
<ui:param name="labelstyle" value="width:200px;" />
<ui:param name="waitdlg" value="1" />

<ui:define name="body">
<p/>
<s:decorate template="/layout/unit.xhtml">
<h:form id="main">

<s:fragment rendered="#{not empty orderSources}">

    <s:decorate template="/layout/display.xhtml" >
    	<ui:define name="label">#{messages['Order.tbunitTo']}:</ui:define>
    	#{order.tbunitTo.name}
    </s:decorate>

    <s:decorate template="/layout/display.xhtml" >
    	<ui:define name="label">#{messages['TbUnit.numDaysOrder']}:</ui:define>
    	#{order.tbunitFrom.numDaysOrder}
    </s:decorate>

    <s:decorate template="/layout/display.xhtml" >
    	<ui:define name="label">#{messages['global.comments']}:</ui:define>
    	<h:inputText value="#{order.comments}" maxlength="200" style="width:400px;" />
    </s:decorate>

	<p/>

<table width="100%">
<c:forEach items="#{orderSources}" var="s">
	<tr><td class="colheader">
		<b>#{s.source.name}</b>
	</td></tr>
	<tr><td>
		<h:dataTable value="#{s.items}" var="it" class="tabela" columnClasses="colb,colrb,colrb,colrb,highlight colrb" rowClasses="lin1" width="100%">
			<h:column>
			<f:facet name="header">Item</f:facet>
				<img src="../img/medicine.gif" style="float:left;"/>
				#{it.item.medicine}
			</h:column>
			
			<h:column>
			<f:facet name="header"><h:outputText value="#{messages['medicines.orders.available']}" styleClass="colrh"/></f:facet>
				#{it.stockQuantity}
			</h:column>
			
			<h:column>
				<f:facet name="header"><h:outputText value="#{messages['OrderItem.numPatients']}" styleClass="colrh"/></f:facet>
				#{it.item.numPatients}
			</h:column>
			
			<h:column>
			<f:facet name="header"><h:outputText value="#{messages['OrderItem.estimatedQuantity']}" styleClass="colrh"/></f:facet>
				#{it.item.estimatedQuantity}
			</h:column>
			
			<h:column>
			<f:facet name="header"><h:outputText value="#{messages['OrderItem.requestedQuantity']}" styleClass="colrh"/></f:facet>
				<h:outputText value="#{it.item.requestedQuantity}" rendered="#{not order.tbunitFrom.changeEstimatedQuantity}" />
				<h:panelGroup>
					<h:inputText id="qtd" value="#{it.item.requestedQuantity}" style="width:60px;" rendered="#{order.tbunitFrom.changeEstimatedQuantity}" required="true">
					</h:inputText>
					<h:message for="qtd" styleClass="erro" />
				</h:panelGroup>
			</h:column>

		</h:dataTable>
		<p/>
	</td></tr>
</c:forEach>

	<tr><td style="text-align:right;">
            <a:commandButton action="#{orderHome.saveNew}" value="#{messages['form.ok']}" styleClass="button" reRender="msg,main"/>
            <s:button action="cancel" value="#{messages['form.cancel']}" styleClass="button-cancel" />
	</td></tr>
</table>
</s:fragment>

<s:fragment rendered="#{empty orderSources}" >
<s:decorate template="/layout/rounded.xhtml" style="padding:10px;width:80%;">
	<ui:param name="color" value="orange" />
	<div style="padding:10px;font-weight:bold;color:white;">
		#{messages['medicines.orders.nomedicine']}
	</div>
</s:decorate>
    <s:button action="cancel" value="#{messages['form.cancel']}" styleClass="button-cancel" style="float:right;"/>	
</s:fragment>

</h:form>
</s:decorate>
</ui:define>

</ui:composition>  
