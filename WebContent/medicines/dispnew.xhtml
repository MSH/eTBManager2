<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      xmlns:c="http://java.sun.com/jstl/core"
      template="/layout/template_new.xhtml">

<ui:param name="title" value="#{messages['dispensing.new']}" />

<ui:param name="topmenu" value="1" />
<ui:param name="labelstyle" value="width:220px;" />

<ui:define name="left">
</ui:define>

<ui:define name="content">
<h1>#{title}</h1>
<h:form id="main" styleClass="form1"> 

	<div class="form-content">

    <s:decorate template="/layout/dateedit.xhtml" >
    	<ui:define name="label">#{messages['meds.dispensing.date']}:</ui:define>
    	<ui:param name="datefield" value="#{batchDispensingUIHome.dispensingDate}" /> 
		<ui:param name="required" value="true" />
    </s:decorate>
	
	</div>
    
    <a:repeat value="#{batchDispensingUIHome.sources}" var="s">
    <h2>#{s.source}</h2>
    	<a:repeat value="#{s.medicines}" var="med">
    		<table class="table1">
    			<td>
					<div id="med-row">
					<div style="float:left;width:450px;">
						<a:commandLink onclick="detailsClick(this);return false;">
							<div class="plus-icon" style="float:left;"/>
						</a:commandLink>
						<h:outputText value="#{med.medicine}" />
					</div>
					<div style="float:left;width:140px;text-align:right;">
					<h:outputText value="#{med.quantityAvailable}" >
						<f:convertNumber pattern="#,###,###,##0"/>
					</h:outputText>
					</div>
					</div>
			
					<div id="tblbatch" style="display:none;">					
					<a:repeat value="#{med.items}" var="b">
					<div style="clear:both;position:relative;min-height:40px;height:40px;border-top:1px solid #d0d0d0;padding-top:4px;">
					<div style="float:left;width:350px;padding-left:30px;">
					<s:decorate template="/layout/batch.xhtml" >
						<ui:param name="batch" value="#{b.batchQuantity.batch}" />
					</s:decorate>
					</div>
				<div style="float:left;width:130px;text-align:center;">
					<h:outputText value="#{b.batchQuantity.batch.expiryDate}" converter="localeDateConverter" />
				</div>
				<div style="float:left;width:130px;text-align:right;">
					<h:outputText value="#{b.dispensingQuantity}">
						<f:convertNumber pattern="#,###,##0"/>
					</h:outputText>
				</div>
			</div>
		</a:repeat>
		</div>
    			</td>
    		</table>
    	</a:repeat>
    </a:repeat>
	
    <div class="button-bar">
        <h:commandLink action="#{batchDispensingUIHome.saveDispensing}" styleClass="button"  >
        	<span>#{messages['form.ok']}</span>
        </h:commandLink>  
        <s:link view="/medicines/index.xhtml" styleClass="button-alt" propagation="end" >
        	<span>#{messages['form.cancel']}</span>
        </s:link>
    </div>

</h:form>

<script type="text/javascript">
<!--
waitdiv = '<div style="float:left" class="wait-icon"/>';
function detailsClick(elem) {
	var tbl=jQuery(elem).closest("td").find("#tblbatch");
	var bVisible=jQuery(tbl).is(":visible");
	tbl.slideToggle(500);
/*	if (bVisible)
		 jQuery(elem).text('#{messages['form.details']}');
	else jQuery(elem).text('#{messages['form.hidedetails']}'); */
	
}

-->
</script>

</ui:define>

</ui:composition>  
