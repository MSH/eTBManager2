<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      template="..#{workspaceViewService.templatePage}">

<ui:param name="title" value="#{messages['cases.regimens.edt']}" />

<ui:param name="topmenu" value="0" />
<ui:param name="labelstyle" value="width:180px" />

<ui:define name="body">
<p/>
<h:form id="main">

<rich:panel style="width:750px">

	<s:decorate template="../layout/display.xhtml">
    	<ui:define name="label">#{messages['Patient.name']}:</ui:define>
    	#{tbCase.patient.fullName}
	</s:decorate>
	
	<s:decorate template="../layout/display.xhtml">
    	<ui:define name="label">#{messages['Patient.securityNumber']}:</ui:define>
		#{tbCase.patient.securityNumber}
	</s:decorate>
	
	<s:decorate id="dt" template="../layout/display.xhtml">
    	<ui:define name="label">#{messages['TbCase.beginningTreatmentDate']}:</ui:define>
    	<h:outputText id="dt" value="#{tbCase.beginningTreatmentDate}">
        	<s:convertDateTime timeZone="#{timezones.default}" />
    	</h:outputText>
	</s:decorate>
	<p/>
	
	<h3>#{messages['Regimen']}</h3>
	
	<div style="margin-top:10px;margin-bottom:4px;">
	<s:decorate template="/layout/roundeds.xhtml">
		<ui:param name="color" value="#B3DCB3" />
		<ui:param name="bgcolor" value="#fff" />
		<div style="font-size:14px;font-weight:bold;">
			#{messages['RegimenPhase.INTENSIVE']}
		</div>
	</s:decorate>
	</div>
	<a:commandLink action="#{individualizedRegimen.filterIntPhaseMedicines}" ajaxSingle="true" value="#{messages['Regimen.add']}" styleClass="button2" reRender="medpnl,buttons" oncomplete="showMedicinesDlg()" style="width:180px;display:block;" />
	    <s:decorate template="/layout/edit.xhtml">
    		<ui:define name="label">#{messages['PrescribedMedicine.beginningDate']}:</ui:define>
    		<h:outputText id="dt" value="#{tbCase.beginningTreatmentDate}" >
        		<s:convertDateTime timeZone="#{timezones.default}"/>
    		</h:outputText>
		</s:decorate>

    <h:panelGroup id="tabint">
	<h:dataTable value="#{individualizedRegimen.intPhaseRegimen.medicines}" var="m" width="100%" rowClasses="lin1,lin2" styleClass="tabela" rendered="#{not empty individualizedRegimen.intPhaseRegimen.medicines}" style="margin-bottom:30px;">
		<h:column>
			<f:facet name="header">
				<h:outputText value="#{messages['Medicine']}" styleClass="collh" style="padding-left:10px;"/>
			</f:facet>
			<img src="../img/medicine.gif" style="float:left;"/>
			#{m.medicine}
		</h:column>
		
		<h:column>
			<f:facet name="header">#{messages['form.action']}</f:facet>
			<h:commandLink value="#{messages['form.remove']}" action="#{individualizedRegimen.remIntPhaseMedicine(m)}"></h:commandLink>
		</h:column>
	</h:dataTable>
	</h:panelGroup>

	
	<div style="margin-top:10px;margin-bottom:4px;">
	<s:decorate template="/layout/roundeds.xhtml">
		<ui:param name="color" value="#B3DCB3" />
		<ui:param name="bgcolor" value="#fff" />
		<div style="font-size:14px;font-weight:bold;">
			#{messages['RegimenPhase.CONTINUOUS']}
		</div>
	</s:decorate>
	</div>
	<a:commandLink action="#{individualizedRegimen.filterContPhaseMedicines}" ajaxSingle="true" value="#{messages['Regimen.add']}" styleClass="button2" reRender="medpnl,buttons" oncomplete="showMedicinesDlg()" style="width:180px;display:block;" />

	<table width="100%">
	<tr><td>
	    <s:decorate template="/layout/edit.xhtml">
    		<ui:define name="label">#{messages['PrescribedMedicine.beginningDate']}:</ui:define>
	    	<rich:calendar value="#{individualizedRegimen.contPhaseRegimen.beginningDate}" enableManualInput="true" required="true" 
    			locale="#{locale}" datePattern="#{messages['locale.datePattern']}" timeZone="#{timezones.default}" />
    		(#{messages['locale.displayDatePattern']})
		</s:decorate>
	</td><td>
	    <s:decorate template="/layout/edit.xhtml">
    		<ui:define name="label">#{messages['PrescribedMedicine.endingDate']}:</ui:define>
	    	<rich:calendar value="#{individualizedRegimen.contPhaseRegimen.endingDate}" enableManualInput="true" required="true" 
    			locale="#{locale}" datePattern="#{messages['locale.datePattern']}" timeZone="#{timezones.default}" />
    		(#{messages['locale.displayDatePattern']})
		</s:decorate>
	</td></tr>
	</table>

    <h:panelGroup id="tabcont">
	<h:dataTable value="#{individualizedRegimen.contPhaseRegimen.medicines}" var="m" width="100%" rowClasses="lin1,lin2" styleClass="tabela" rendered="#{not empty individualizedRegimen.contPhaseRegimen.medicines}" style="margin-bottom:30px;">
		<h:column>
			<f:facet name="header">
				<h:outputText value="#{messages['Medicine']}" styleClass="collh" style="padding-left:10px;"/>
			</f:facet>
			<img src="../img/medicine.gif" style="float:left;"/>
			#{m.medicine}
		</h:column>
		
		<h:column>
			<f:facet name="header">#{messages['form.action']}</f:facet>
			<h:commandLink value="#{messages['form.remove']}" action="#{individualizedRegimen.remContPhaseMedicine(m)}"></h:commandLink>
		</h:column>
	</h:dataTable>
	</h:panelGroup>


	<p/>

	<div style="display:block;float:right">
   		<h:commandButton action="#{individualizedRegimen.updateRegimen}" value="#{messages['form.ok']}" styleClass="button" />
   		<s:button value="#{messages['form.cancel']}" view="/cases/casenew.xhtml" styleClass="button-cancel" />
	</div>

</rich:panel>
</h:form>

<s:decorate id="dlg1" template="/layout/medicineselection.xhtml" >
	<ui:param name="for" value="dlg1" />
	<ui:param name="title" value="#{messages['Regimen.add']}" />
	<h:panelGroup id="buttons">
		<a:commandButton value="#{messages['form.ok']}" styleClass="button" action="#{individualizedRegimen.addIntPhaseMedicines}" oncomplete="hideMedicinesDlg();" reRender="tabint" rendered="#{individualizedRegimen.intensive}"/>
		<a:commandButton value="#{messages['form.ok']}" styleClass="button" action="#{individualizedRegimen.addContPhaseMedicines}" oncomplete="hideMedicinesDlg();" reRender="tabcont" rendered="#{not individualizedRegimen.intensive}"/>
	</h:panelGroup>
</s:decorate>

</ui:define>

</ui:composition>  
