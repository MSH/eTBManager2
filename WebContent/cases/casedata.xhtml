<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      template="/layout/template_new.xhtml">


<ui:param name="title" value="#{messages['cases.details']} - #{tbcase.diagnosisType=='SUSPECT'? messages[tbcase.classification.keySuspect] : messages[tbcase.classification.key]}" />
<ui:param name="topmenu" value="0" />
<ui:param name="labelstyle" value="width:160px" />


<ui:define name="naveg">
	<div class="item">
		<s:link value="#{messages['cases']}" view="/cases/index.html" propagation="none"/>
	</div>
	<div class="item">
		<s:link value="#{messages['cases.searchresult']}" view="/cases/searchresult.xhtml" />
	</div>
	<div class="item selected">
		<s:link value="#{messages[tbcase.classification.key]}" />
	</div>
</ui:define>


<ui:define name="state-content">
	<s:fragment rendered="#{tbcase.state=='TRANSFERRING'}" > 
	<div class="icon-hu-big"/>
	<div style="margin-top:6px;font-size:11px;max-width:320px;height:60px;" >
		<b style="padding-right:4px;">#{messages['meds.movs.destunit']}:</b> <h:outputText value="#{caseHome.transferInHealthUnit.tbunit.name}" />
		<br/>
		<span class="right-icon" />
		<s:link value="#{messages['cases.move.regtransferin']}" view="/cases/casetransferin.xhtml" 
			style="position:relative;" propagation="none">
			<f:param name="id" value="#{caseHome.id}" />
		</s:link>
		<s:link value="#{messages['cases.move.cancel']}" 
			style="position:relative" />
	</div>
	</s:fragment>
</ui:define>
		

<ui:define name="left">
	<h:panelGroup id="leftmenu" styleClass="vertical-menu">
	<h:form class="vertical-menu">

	<s:link view="/reports/casedata.xhtml" target="_new">
		<div class="print-icon"/>#{messages['global.print']}
		<f:param name="id" value="#{caseHome.id}" />
	</s:link>

	<h:commandLink action="#{caseHome.remove}" 
		onclick="if (!confirm('#{messages['form.confirm_remove']}')) return false;" 
		rendered="#{caseHome.canEditCaseData}">
		<div class="delete-icon"/><span>#{messages['form.remove']}</span>
	</h:commandLink>

	<s:link value="#{messages['cases.close']}" view="/cases/closecase.xhtml" rendered="#{caseHome.canClose}">
		<f:param name="id" value="#{caseHome.id}" />
	</s:link>

	<h:commandLink value="#{messages['cases.reopen']}" action="#{caseCloseHome.reopenCase}"
		rendered="#{caseHome.canReopen}" 
		onclick="if (!confirm('#{messages['cases.reopen.confirm']}')) return false;">
	</h:commandLink>

	<s:link view="/cases/casehistory.xhtml" >
		<f:param name="id" value="#{caseHome.id}" />
		<div class="icon-report" style="float:none;" /><span>#{messages['form.logreport']}</span>
	</s:link>

	<s:link value="#{messages['admin.tags']}" view="/cases/casetagsedt.xhtml" rendered="#{caseHome.canTagCase and empty tbcase.tags}">
		<f:param name="id" value="#{caseHome.id}" />
	</s:link>

	</h:form>
	</h:panelGroup>

	<s:fragment rendered="#{facesContext.renderResponse}">
	<s:fragment rendered="#{not empty tbcase.tags}">
	<table class="table2">
	<tr>
		<th>#{messages['admin.tags']}</th>
	</tr>
	<tr>
		<td>
		<a:repeat value="#{tbcase.tags}" var="it">
			<div class="tag-#{it.type}-icon"/>#{it.name}<br/>
		</a:repeat>
		</td>
	</tr>
	<s:fragment rendered="#{caseHome.canTagCase}">
	<tr>
		<th>
		<s:link value="#{messages['form.edit']}" 
			rendered="#{caseHome.canEditCaseData}" 
			view="/cases/casetagsedt.xhtml">
			<f:param name="id" value="#{caseHome.id}"/>
		</s:link>
		</th>
	</tr>
	</s:fragment>
	</table>
	</s:fragment>
	</s:fragment>

	<div class="spacer" />

	<s:div styleClass="region1" rendered="#{not empty caseHome.otherCases}">
		<div class="header">#{messages['cases.details.others']} #{tbcase.patient.name}</div>
		<div class="content">
		<h:dataTable id="taboc" value="#{caseHome.otherCases}" var="it" style="font-size:10px;" 
			columnClasses="coll" width="100%">
			<h:column>
				<div onclick="openWaitDlg();location.href='#{request.contextPath}/cases/casedata.seam?id=#{it.id}';" style="cursor:pointer;">
				<b style="color:green;font-size:12px;width:100%;text-decoration: underline;">#{messages[it.classification.key]}
				</b>
				<br/>
				#{it.notificationUnit.name}
				<p/>
				<b>#{messages['TbCase.registrationDate']}:</b><br/> <h:outputText value="#{it.registrationDate}" converter="localeDateConverter" />
				<p/>
				<b>#{messages['CaseState']}:</b><br/> #{messages[it.state.key]}
				<hr style="margin-bottom:16px;" />
				</div>
			</h:column>
		</h:dataTable>
		<rich:jQuery selector="#taboc tr" 
                query="mouseover(function(){jQuery(this).addClass('sel-row')})"/>
		<rich:jQuery selector="#taboc tr" 
                query="mouseout(function(){jQuery(this).removeClass('sel-row')})"/>
		</div>
	</s:div>
</ui:define>



<ui:define name="content">
<h1>#{title}</h1>
<h:form id="main">
<s:decorate id="bodydiv" template="/layout/casebody.xhtml">

	<ui:define name="state-content">
		<s:div rendered="#{tbcase.state=='TRANSFERRING'}" styleClass="icon-hu-big" style="margin-top:6px;font-size:11px;max-width:320px;" >
			<b style="padding-right:4px;">#{messages['meds.movs.destunit']}:</b> <h:outputText value="#{caseHome.transferInHealthUnit.tbunit.name}" />
			<br/>
			<s:link value="#{messages['cases.move.regtransferin']}" view="/cases/casetransferin.xhtml" 
				style="position:relative;" propagation="none" 
				styleClass="right-icon">
				<f:param name="id" value="#{caseHome.id}" />
			</s:link>
			<br/>
			<a:commandLink value="#{messages['cases.move.cancel']}"
				onclick="if (!confirm('#{caseMoveHome.confirmMsgRollbackTransfer}')) return false"
				action="#{caseMoveHome.rollbackTransferOut}"
				reRender="main,leftmenu,messages" 
				style="position:relative" styleClass="right-icon" >
				<f:param name="name" value="#{caseHome.transferInHealthUnit.tbunit.name}"/>
			</a:commandLink>
		</s:div>
	</ui:define>

<ui:include src="/cases/issues.xhtml" />

<div class="spacer" />

<rich:tabPanel switchType="client" id="tabCase">
<rich:tab label="#{messages['cases.details.case']}" id="tab1" ontabenter="updateTab(1)">
	<h:panelGroup id="pnltab1">
		<s:decorate template="/cases/data.xhtml" rendered="#{caseFilters.caseTab==1}"/>
	</h:panelGroup>
</rich:tab>

<rich:tab label="#{messages['cases.details.exams']}" id="tab2" ontabenter="updateTab(2)">
	<h:panelGroup id="pnltab2">
		<s:decorate template="/cases/exams.xhtml" rendered="#{caseFilters.caseTab==2}"/>
	</h:panelGroup>
</rich:tab>

<rich:tab label="#{messages['cases.details.treatment']}" id="tab3" ontabenter="updateTab(3)">
	<h:panelGroup id="pnltab3">
		<s:decorate template="/cases/treatment.xhtml" rendered="#{caseFilters.caseTab==3}"/>
	</h:panelGroup>
</rich:tab>

<rich:tab label="#{messages['cases.details.medexam']}" id="tab4" ontabenter="updateTab(4)">
	<h:panelGroup id="pnltab4">
		<s:decorate template="/cases/medexamination.xhtml" rendered="#{caseFilters.caseTab==4}"/>
	</h:panelGroup>
</rich:tab>

<rich:tab label="#{messages['cases.details.otherinfo']}" id="tab5" ontabenter="updateTab(5)">
	<h:panelGroup id="pnltab5">
		<s:decorate template="/cases/otherinfo.xhtml" rendered="#{caseFilters.caseTab==5}"/>
	</h:panelGroup>
</rich:tab>

<rich:tab label="#{messages['cases.details.report1']}" id="tab6" ontabenter="updateTab(6)">
	<h:panelGroup id="pnltab6">
		<s:decorate template="/cases/drugogram.xhtml" rendered="#{caseFilters.caseTab==6}"/>
	</h:panelGroup>
</rich:tab>

</rich:tabPanel>


<a:jsFunction name="updateTabContent" reRender="pnltab#{caseFilters.caseTab}">
	<a:actionparam name="param1" assignTo="#{caseFilters.caseTab}" converter="javax.faces.Integer" />
</a:jsFunction>
<a:jsFunction name="updateTabSelection">
	<a:actionparam name="param1" assignTo="#{caseFilters.caseTab}" converter="javax.faces.Integer" />
</a:jsFunction>
<script type="text/javascript">
<!--
window.tabLoaded = new Array();
window.inicasetab = #{caseFilters.caseTab};
jQuery().ready(function() {
	initTab();
});
function initTab() {
	var updt=window.inicasetab==0;
	if (updt)
		window.inicasetab=1;
	var tabid = 'tab' + window.inicasetab;
	var dest = 'main:bodydiv:tab' + window.inicasetab;
	RichFaces.switchTab('main:bodydiv:tabCase', dest, tabid);
	if (updt)
		updateTab(window.inicasetab);
}

function updateTab(tabIndex) {
	if (window.tabLoaded[tabIndex]==undefined) {
		window.updateTabContent(tabIndex);
		window.tabLoaded[tabIndex]=1;
	}
	else updateTabSelection(tabIndex);
}
-->
</script>

</s:decorate>	

</h:form>

</ui:define>

</ui:composition>  
