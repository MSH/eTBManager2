<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      template="#{workspaceViewService.templatePage}">

<ui:param name="title" value="#{messages['cases.searchresult']}" />
<ui:param name="topmenu" value="0" />
<ui:param name="left" value="0" />
<ui:param name="waitdlg" value="1" />

<ui:define name="naveg">
	<s:link value="#{messages['cases']}" view="/cases/index.html" propagation="none"/>
</ui:define>

<ui:define name="left">
</ui:define>

<ui:define name="head">
<style type="text/css">
.searchtitle{
/* 	background-color:#e0e0e0; */
	border:1px solid #d0d0d0;
}
.searchtitle a {
/*   color:black; */
   font-size:10px;
   text-transform:uppercase;
   font-weight:bold;
}
</style>
</ui:define>

<ui:define name="body">

	<h:form id="listCases">

	<table width="99%"><tr><td>
	
		<s:decorate template="/layout/navegajax.xhtml">
			<ui:param name="list" value="#{cases}" />
			<ui:param name="reRender" value="listCases" />
		</s:decorate>
	
	</td><td align="right">
		<h:commandButton value="#{messages['cases.newsearch']}" styleClass="button" onclick="Richfaces.showModalPanel('filtersdlg');return false;" style="float:right;width:150px;"/>	
	</td></tr></table>
	
	<h:panelGroup id="res">
	<table id="tblres" width="100%" class="tabela">
		<tr><th class="searchtitle">
				<div style="padding:4px;">
				<a:commandLink value="#{messages['Patient.caseNumber']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="0" />
				</a:commandLink>
				<br/><br/>
				<a:commandLink value="#{messages['Gender']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="1" />
				</a:commandLink>
				</div>
			</th>
			<th class="searchtitle">
				<div style="padding:4px;">
				<a:commandLink value="#{messages['CaseClassification']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="2" />
				</a:commandLink>
				<br/><br/>
				<a:commandLink value="#{messages['Patient.name']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="3" />
				</a:commandLink>
				<br/><br/>
				<a:commandLink value="#{messages['TbCase.patientAge']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="4" />
				</a:commandLink>
				</div>
			</th>
			<th class="searchtitle">
				<div style="padding:4px;">
				<a:commandLink value="#{messages['cases.details.notifhu']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="5" />
				</a:commandLink>
				<br/><br/>
				<a:commandLink value="#{levelInfo.nameLevel1}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="6" />
				</a:commandLink>
				 - 
				<a:commandLink value="#{levelInfo.nameLevel2}" style="margin-left:4px;" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="7" />
				</a:commandLink>
				(#{messages['Address']})
				<br/><br/>
				<a:commandLink value="#{messages['CaseState']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="8" />
				</a:commandLink>
				</div>
			</th>
			<th class="searchtitle">
				<div style="padding:4px;">
				<a:commandLink value="#{messages['TbCase.registrationDate']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="9" />
				</a:commandLink>
				<br/><br/>
				<a:commandLink value="#{messages['cases.casesearching.treatlen']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="10" />
				</a:commandLink>
				<br/><br/>
				<a:commandLink value="#{messages['ValidationState']}" reRender="listCases" bypassUpdates="true" ajaxSingle="true">
					<a:actionparam assignTo="#{caseFilters.newOrder}" value="11" />
				</a:commandLink>
				</div>
			</th>
		</tr>
	<ui:repeat value="#{cases.resultList}" var="it">
	<tr><td width="90px" align="center">
			<s:link value="#{it.caseNumber==null?messages['cases.new']:it.displayCaseNumber}" view="/cases/casedata.xhtml">
				<f:param name="id" value="#{it.caseId}" />
			</s:link>
			<br/>
			<s:link view="/cases/casedata.xhtml" 
				styleClass="#{it.gender=='MALE'?'male-icon':'female-icon'}" style="margin-left:30px;">
				<f:param name="id" value="#{it.caseId}" />
			</s:link>
	</td>
	<td style="border-left:1px solid #E0E0E0;">
		<b>#{messages[it.classification.key]}</b>
		<div style="padding-top:6px;clear:left;">
		#{it.patientName}
		<br /> #{it.patientAge} #{messages['global.age']}
		</div>
	</td>
	<td style="border-left:1px solid #E0E0E0;">
		<b>#{it.healthUnit}</b><br />
		<h:outputText value="#{it.region} - #{it.locality}" style="font-size:10px;" /> 
   		<div style="padding-top:6px;clear:left;">
   		<h:outputText value="#{messages[it.caseState.key]}" style="color:#8DA48F;font-weight:bold;" />
   		</div>		
	</td>
	<td style="border-left:1px solid #E0E0E0;">
		<h:outputText value="#{it.notificationDate}" converter="localeDateConverter" />
   		<h:outputText value="#{it.beginningTreatmentDate}" converter="periodConverter" 
   			rendered="#{it.beginningTreatmentDate!=null}" 
   			style="padding-top:6px;display:block;">
   			<f:param name="endDate" value="#{it.endingTreatmentDate}" />
   			<f:param name="type" value="length" />
   		</h:outputText>
   		<h:outputText value="#{messages['cases.details.notreatment']}" rendered="#{it.beginningTreatmentDate==null}"
   			style="padding-top:6px;display:block;"/>
   		<h:outputText value="#{messages[it.validationState.key]}" style="color:#8DA48F;font-weight:bold;padding-top:6px;display:block;"/>
	</td>
	</tr>
	</ui:repeat>
	</table>
	</h:panelGroup>

	<s:decorate template="/layout/navegbottom.xhtml">
		<ui:param name="list" value="#{cases}" />
		<ui:param name="page" value="/cases/searchresult.xhtml" />
	</s:decorate>
	
	<rich:jQuery selector="#tblres tr:odd" query="addClass('lin1')" />
	<rich:jQuery selector="#tblres tr:even" query="addClass('lin2')" />
</h:form>	



<rich:modalPanel id="filtersdlg" height="550" width="680" top="100" zindex="2000">
	<f:facet name="header">
		#{messages['cases.newsearch']}
	</f:facet>
	<h:form>
	<a:region>
	
	<table width="99%">
	<tr><td colspan="2">

	<ui:include src="searchfilters.xhtml" />

	</td></tr>
	<tr><td>
		<ui:include src="/layout/waitstatus.xhtml" />
	</td>

	<td align="right">
		<a:commandButton id="btnsearch" value="#{messages['form.search']}" action="#{cases.refresh}" 
			styleClass="button"	reRender="listCases" onclick="if (!validateFilters()) return false;this.disabled=true"
			oncomplete="this.disabled=false;Richfaces.hideModalPanel('filtersdlg');return false;">
			<a:actionparam assignTo="#{caseFilters.searchCriteria}" value="#{'CUSTOM_FILTER'}"/>
		</a:commandButton>
		<s:button value="#{messages['form.cancel']}" onclick="Richfaces.hideModalPanel('filtersdlg');return false;" styleClass="button-cancel"/>
	</td></tr></table>	
	</a:region>
	<rich:hotKey selector="#tblfilters input,select" key="return" handler="#{rich:element('btnsearch')}.click();" /> 
	</h:form>
</rich:modalPanel>

</ui:define>

</ui:composition>  
