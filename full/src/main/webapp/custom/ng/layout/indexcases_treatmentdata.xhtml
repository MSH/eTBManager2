<?xml version="1.0" encoding="UTF-8"?>
<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:f="http://java.sun.com/jsf/core"
                 xmlns:h="http://java.sun.com/jsf/html"
                 xmlns:ui="http://java.sun.com/jsf/facelets"
                 xmlns:s="http://jboss.com/products/seam/taglib"
                 xmlns:a="https://ajax4jsf.dev.java.net/ajax">

    <s:fragment rendered="#{not empty grp and not empty grp.treatments}">
    <s:div id="#{idList}">
        <table class="table2" >
            <tr>
                <th align="left"><a:commandLink value="#{messages['Patient']}" onclick="changeOrder#{idList}(1);return false;" styleClass="link-header-sr"/></th>
                <s:fragment rendered="#{suspects}">
                    <th align="left"><a:commandLink value="#{messages['TbCase.registrationDate']}" onclick="changeOrder#{idList}(4);return false;" styleClass="link-header-sr"/></th>
                    <th align="center">
                        #{messages['cases.examxpert']}
                    </th>
                    <th align="center">
                        #{messages['cases.exammicroscopy']}
                    </th>
                    <s:fragment rendered="false">
                        <th align="center">
                            #{messages['cases.examculture']}
                        </th>
                    </s:fragment>
                </s:fragment>
                <s:fragment rendered="#{not suspects}">
                    <th align="left"><a:commandLink value="#{messages['PatientType']}" onclick="changeOrder#{idList}(2);return false;" styleClass="link-header-sr"/></th>
                    <th align="left"><a:commandLink value="#{messages['InfectionSite']}" onclick="changeOrder#{idList}(3);return false;" styleClass="link-header-sr"/></th>
                    <th align="left"><a:commandLink value="#{messages['TbCase.registrationDate']}" onclick="changeOrder#{idList}(4);return false;" styleClass="link-header-sr"/></th>
                    <th align="left"><a:commandLink value="#{messages['TbCase.iniTreatmentDate']}" onclick="changeOrder#{idList}(5);return false;" styleClass="link-header-sr"/></th>
                    <th>#{messages['cases.mantreatmentplaned']}(%)</th>
                    <th>#{messages['cases.actualtreatprogr']}(%)</th>
                </s:fragment>
            </tr>
            <a:repeat value="#{grp.treatments}" var="it">
                <tr>
                    <td>
                        <s:link value="#{it.patientName}" view="/cases/casedata.xhtml" >
                            <f:param name="id" value="#{it.caseId}"/>
                        </s:link>
                    </td>
                    <s:fragment rendered="#{suspects}">
                        <td>
                            <h:outputText value="#{it.registrationDate}" converter="localeDateConverter"/>
                        </td>
                        <td align="center">
                            <h:outputText value="#{messages[it.xpertResult.key]}" styleClass="badge #{it.xpertResult=='TB_DETECTED'?'color-danger':'color-success'}" rendered="#{not empty it.xpertResult}"/>
                            <div style="margin-top:4px">
                                <h:outputText value="#{messages[it.xpertRifResult.key]}"
                                              rendered="#{it.xpertResult=='TB_DETECTED'}"
                                              styleClass="badge #{it.xpertRifResult == 'RIF_DETECTED'?'color-danger': (it.xpertRifResult == 'RIF_NOT_DETECTED'? 'color-success':'color-warning')}"/>
                            </div>
                        </td>
                        <td align="center">
                            <h:outputText value="#{messages[it.microscopyResult.key]}" rendered="#{not empty it.microscopyResult}"
                                          styleClass="badge #{it.microscopyResult=='NEGATIVE'? 'color-success': 'color-danger'}"/>
                        </td>
                        <s:fragment rendered="false">
                            <td align="center">
                                <h:outputText value="#{messages[it.cultureResult.key]}"
                                              styleClass="badge #{r.result=='NEGATIVE'? 'color-success': 'color-danger'}"
                                              rendered="#{not empty it.cultureResult}" />
                            </td>
                        </s:fragment>
                    </s:fragment>
                    <s:fragment rendered="#{not suspects}">
                        <td>
                            <h:outputText value="#{messages[it.patientType.key]}" />
                        </td>
                        <td>
                            <h:outputText value="#{messages[it.infectionSite.key]}" />
                            <s:fragment rendered="#{it.infectionSite == 'PULMONARY'}">
                                <span class="hint">#{it.pulmonaryType}</span>
                            </s:fragment>
                        </td>
                        <td>
                            <h:outputText value="#{it.registrationDate}" converter="localeDateConverter"/>
                        </td>
                        <td align="left">
                            <h:outputText value="#{it.treatmentPeriod.iniDate}" converter="localeDateConverter" />
                        </td>
                        <td align="left" width="115px">
                            <s:fragment rendered="#{it.progressPoints!=null}">
                                <div class="progress-icon" style="width:#{it.progressPoints*0.7}px;float:left;">
                                    <!-- &nbsp;  -->
                                </div>
                            <span class="hint">
                                <h:outputText value="#{it.plannedProgress}">
                                    <f:convertNumber pattern="#,###,##0.0"/>
                                </h:outputText>%
                            </span>
                            </s:fragment>
                        </td>
                        <td align="left" width="115px">
                            <s:fragment rendered="#{it.medicineIntakePoints!=null}">
                                <div class="progress-icon" style="width:#{it.medicineIntakePoints*0.7}px;float:left;">
                                    <!-- &nbsp;  -->
                                </div>
                            <span class="hint">
                                <h:outputText value="#{it.takenMedicineProgress}" >
                                    <f:convertNumber pattern="#,###,##0.0"/>
                                </h:outputText>%
                            </span>
                            </s:fragment>
                        </td>
                    </s:fragment>
                </tr>
            </a:repeat>
        </table>
    </s:div>
    </s:fragment>

    <s:fragment rendered="#{empty grp or empty grp.treatments}">
        <span class="warn">#{messages['cases.details.noresultfound']}</span>
    </s:fragment>

    <a:jsFunction name="changeOrder#{idList}" reRender="#{idList}" ajaxSingle="true" bypassUpdates="true"  >
        <a:actionparam name="param1" assignTo="#{treatmentsInfoHomeNg.orderby}" converter="javax.faces.Integer" />
    </a:jsFunction>
</ui:composition>