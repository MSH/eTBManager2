<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:s="http://jboss.com/products/seam/taglib"
      xmlns:c="http://java.sun.com/jstl/core"
      xmlns:a="https://ajax4jsf.dev.java.net/ajax"
      xmlns:rich="http://richfaces.ajax4jsf.org/rich"
      template="/layout/template_new.xhtml">

<ui:param name="title" value="#{messages['labs.title']}" />
<ui:param name="topmenu" value="4" />

<ui:define name="naveg">
	<div class="item selected">
		<s:link value="#{messages['labs']}" />
	</div>
</ui:define>

<ui:define name="left">
	<h:form>

	<s:link view="/labs/newpac.xhtml" styleClass="button-alt" onclick="if (!disableButton(this)) return false;" >
		<span>#{messages['labs.newreq']}</span>
	</s:link>

	</h:form>
</ui:define>

<ui:define name="content">
<h1>#{title}</h1>
<span class="icon-lab-big"/><h2>#{userLaboratory.name}</h2>
<div class="text-small"> #{userLaboratory.adminUnit.fullDisplayName}</div>
<div class="spacer" />
<h:form>
	<h:outputText value="#{messages['Patient']}:"/>
	
	<h:inputText id="patname" value="#{sampleFilters.patient}" style="width:150px;margin:4px" />

	<a:commandLink id="btnsearchpat" action="search" styleClass="button-alt" onclick="if (!disableButton(this)) return false;" >
		<a:actionparam assignTo="#{sampleFilters.searchCriteria}" value="#{'PATIENT'}"/>
		<span>#{messages['form.search']}</span>
	</a:commandLink>
	<div class="hint">#{messages['labs.searchhint']}</div>

	<rich:jQuery timming="onload" selector="#patname" query="focus()" />
	<rich:hotKey selector="#patname" key="return" handler="disableButton(#{rich:element('btnsearchpat')});execSearch();" /> 
	<a:jsFunction name="execSearch" action="search" reRender="messages">
		<a:actionparam name="param1" assignTo="#{sampleFilters.searchCriteria}" value="#{'PATIENT'}"/>
	</a:jsFunction>

	<div class="spacer" />

	<h:panelGroup id="sampleReport">	
	<s:fragment rendered="#{not empty sampleHomeReport.items}">
	<table width="100%" class="table1">
	<tr>
		<th rowspan="2">
			#{messages['cases.details.exams']}
		</th>
		<th rowspan="2">
			#{messages['ExamStatus.REQUESTED']}
		</th>
		<th rowspan="2">
			#{messages['ExamStatus.ONGOING']}
		</th>
		<th>
			<h:inputHidden value="#{sampleHomeReport.month}" />
			<h:inputHidden value="#{sampleHomeReport.year}" />
			<a:commandLink title="Previous month" action="#{sampleHomeReport.previousMonth}" reRender="sampleReport">
				<span class="naveg-prev" style="float:none;"/>
			</a:commandLink>
			<h:outputText value="#{sampleHomeReport.month}" converter="monthYearConverter">
				<f:param name="year" value="#{sampleHomeReport.year}" />
			</h:outputText>
			<a:commandLink title="Next month" action="#{sampleHomeReport.nextMonth}" reRender="sampleReport">
				<span class="naveg-next" style="float:none;"/>
			</a:commandLink>
		</th>
	</tr>
	<tr>
		<th>
			#{messages['ExamStatus.PERFORMED']}
		</th>		
	</tr>
	<a:repeat value="#{sampleHomeReport.items}" var="it">
	<tr>
		<th>
			#{messages[it.type.key]}
		</th>
		<td align="center">
			<s:link view="/labs/searchresult.xhtml" rendered="#{it.getQuantity('REQUESTED') != null}" style="width:100%;text-align:center;display:block">
				<f:param name="m" value="#{sampleHomeReport.month}" />
				<f:param name="y" value="#{sampleHomeReport.year}" />
				<f:param name="r" value="REQUESTED" />
				<f:param name="t" value="#{it.type}" />
				<f:param name="sc" value="TABLE" />
				<h:outputText value="#{it.getQuantity('REQUESTED')}">
					<f:convertNumber pattern="#,###,###"/>
				</h:outputText>
			</s:link>
		</td>
		<td align="center">
			<s:link view="/labs/searchresult.xhtml" rendered="#{it.getQuantity('ONGOING') != null}" style="width:100%;text-align:center;display:block">
				<f:param name="m" value="#{sampleHomeReport.month}" />
				<f:param name="y" value="#{sampleHomeReport.year}" />
				<f:param name="r" value="ONGOING" />
				<f:param name="t" value="#{it.type}" />
				<f:param name="sc" value="TABLE" />
				<h:outputText value="#{it.getQuantity('ONGOING')}">
					<f:convertNumber pattern="#,###,###"/>
				</h:outputText>
			</s:link>
		</td>
		<td align="center">
			<s:link view="/labs/searchresult.xhtml" rendered="#{it.getQuantity('PERFORMED') != null}" style="width:100%;text-align:center;display:block">
				<f:param name="m" value="#{sampleHomeReport.month}" />
				<f:param name="y" value="#{sampleHomeReport.year}" />
				<f:param name="r" value="PERFORMED" />
				<f:param name="t" value="#{it.type}" />
				<f:param name="sc" value="TABLE" />
				<h:outputText value="#{it.getQuantity('PERFORMED')}">
					<f:convertNumber pattern="#,###,###"/>
				</h:outputText>
			</s:link>
		</td>
	</tr>
	</a:repeat>
	</table>

	</s:fragment>
	</h:panelGroup>

</h:form>
</ui:define>


<ui:define name="dialogs">

</ui:define>

</ui:composition>  
