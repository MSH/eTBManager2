<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich"
                template="admintemplate.xhtml">
        
<ui:param name="title" value="#{messages['admin.checkupdate']}" />
<ui:param name="topmenu" value="3" />
<ui:param name="submenu" value="2" />
<ui:param name="labelstyle" value="width:200px" />


<ui:define name="content">
<h1><i class="icon-cog" />#{title}</h1>
<h:form id="main" >

    <div id="divproc">
        <h2>
            <i class="icon-repeat icon-large icon-spin"></i>
            Checking for update
        </h2>
    </div>

    <div id="divresult" style="display:none">
    <h:panelGroup id="pnlstatus">
        <s:fragment rendered="#{appUpdateController.updateAvailable}">
            <div class="message message-info">
                <div class="text-medium">#{messages['admin.checkupdate.msg3']}</div>
            </div>
            <s:decorate template="/layout/display.xhtml">
                <ui:define name="label">Build number:</ui:define>
                <h:outputText value="#{appUpdateController.versionInformation.buildNumber}" />
            </s:decorate>
            <s:decorate template="/layout/display.xhtml">
                <ui:define name="label">Build Date:</ui:define>
                <h:outputText value="#{appUpdateController.versionInformation.buildDate}" converter="localeDateConverter">
                    <f:param id="type" value="date-time"/>
                </h:outputText>
            </s:decorate>
            <a href="#" class="button"><span>#{messages['form.update']}</span></a>
        </s:fragment>

        <s:fragment rendered="#{(not appUpdateController.updateAvailable) and (appUpdateController.versionInformation != null)}">
            <div class="message message-info">
                <div class="text-medium">#{messages['admin.checkupdate.msg2']}</div>
            </div>
        </s:fragment>

        <s:fragment rendered="#{not empty appUpdateController.errorMessage}">
            <div class="message message-error">
                <div class="text-medium">#{messages['admin.checkupdate.msg4']}</div>
                <div>#{appUpdateController.errorMessage}</div>
            </div>
            <div class="spacer"/>
            <div><b>#{messages['SystemConfig.updateSite']}: </b>#{etbmanagerApp.configuration.updateSite}</div>
        </s:fragment>
    </h:panelGroup>
    </div>

    <a:jsFunction name="checkUpdate" oncomplete="afterProcessing(data)" reRender="pnlstatus"
                  action="#{appUpdateController.checkForUpdate}" data="#{appUpdateController.updateAvailable}"/>
</h:form>

<script type="text/javascript">
jQuery(document).ready(function() {
    checkUpdate();
});

function afterProcessing(data) {
    jQuery("#divproc").slideUp();
    jQuery('#divresult').slideDown();
}

</script>

</ui:define>
        
</ui:composition> 
