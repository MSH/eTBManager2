<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich"
                template="/layout/template_new.xhtml">

<ui:param name="title" value="#{messages['cases.regs']}" />

<ui:param name="left" value="0" />
<ui:param name="topmenu" value="0" />
<ui:param name="waitdlg" value="1" />

<ui:param name="labelstyle" value="width:140px" />

<ui:define name="content">

<s:decorate template="/layout/casebody.xhtml">
	<a:form id="formtreat">
	<h:panelGroup id="pnltreatment">
	<a:commandLink value="#{messages['Regimen.add']}..."
		action="#{prescribedMedicineHome.startNew}" 
		style="float:right;width:200px;"
		styleClass="button" 
		reRender="medicinepnl"
		oncomplete="showMedicineDlg();" 
		/>

	<s:decorate template="treattable.xhtml">
		<ui:param name="editing" value="true" />
	</s:decorate>

	</h:panelGroup>

<script type="text/javascript"><!--

function showMedicineDlg() {	Richfaces.showModalPanel('medicinedlg'); }
function showPeriodDlg() {	Richfaces.showModalPanel('perioddlg'); }
function showHuDlg() {	Richfaces.showModalPanel('hudlg'); }

--></script>

	<div style="clear:both;float:right;">
	<a:commandLink action="#{treatmentHome.saveChanges}" value="#{messages['form.ok']}" styleClass="button" 
            	reRender="formtreat,messages" 
            	oncomplete="this.disabled=false;"
            	onclick="this.disabled=true;" />

	<h:commandLink action="cancel" value="#{messages['form.cancel']}" styleClass="button-alt" immediate="true"/>
	</div>
	
	</a:form>
</s:decorate>

</ui:define>

<ui:define name="dialogs">

<rich:modalPanel id="perioddlg" width="500" autosized="true" zindex="2000" trimOverlayedElements="false">
	<f:facet name="header">#{messages['cases.treat']}</f:facet>
	<ui:param name="labelstyle" value="width:110px" />
	<h:panelGroup id="periodpnl">
	<h:form style="padding:10px;" rendered="#{treatmentHome.formEditing=='TREATMENT'}">

	<h:messages globalOnly="false" styleClass="error" layout="table" />
	<s:decorate template="/layout/display.xhtml" rendered="#{not treatmentHome.canChangeIniDate}">
		<ui:define name="label">#{messages['Period.iniDate']}:</ui:define>
		<h:outputText value="#{treatmentHome.iniDate}"/>
	</s:decorate>

	<s:decorate template="/layout/dateedit.xhtml" rendered="#{treatmentHome.canChangeIniDate}">
		<ui:define name="label">#{messages['Period.iniDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{treatmentHome.iniDate}"/> 
	</s:decorate>

	<s:decorate template="/layout/dateedit.xhtml">
		<ui:define name="label">#{messages['Period.endDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{treatmentHome.endDate}"/> 
	</s:decorate>
	
	<a:commandLink value="#{messages['form.ok']}" action="#{treatmentHome.endTreatmentPeriodEditing}"
		data="#{treatmentHome.validated}"
		styleClass="button" reRender="pnltreatment,periodpnl" 
		oncomplete="initializeTreatmentView();if (data) return false; Richfaces.hideModalPanel('perioddlg');"/>

	<a:commandLink value="#{messages['form.cancel']}" styleClass="button-alt"  
		onclick="Richfaces.hideModalPanel('perioddlg'); return false;"/>

	</h:form>
	</h:panelGroup>
</rich:modalPanel>


<rich:modalPanel id="medicinedlg" width="700" height="350" zindex="2000" 
	trimOverlayedElements="false" style="overflow:auto" >
	<f:facet name="header">#{messages['PrescribedMedicine']}</f:facet>
	<ui:param name="labelstyle" value="width:110px" />
	<h:panelGroup id="medicinepnl">
	<h:form style="padding:10px;" rendered="#{treatmentHome.formEditing=='MEDICINE'}">

	<h:messages globalOnly="true" styleClass="error" layout="table" />
	<s:decorate template="/layout/edit.xhtml">
		<ui:define name="label">#{messages['Medicine']}:</ui:define>
		<h:selectOneMenu value="#{prescribedMedicine.medicine}" required="true"> 
			<s:selectItems var="med" value="#{medicines}" noSelectionLabel="-" label="#{med}"/>
			<s:convertEntity />
		</h:selectOneMenu>
	</s:decorate>

	<s:decorate template="/layout/dateedit.xhtml">
		<ui:define name="label">#{messages['Period.iniDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{prescribedMedicine.period.iniDate}"/> 
	</s:decorate>

	<s:decorate template="/layout/dateedit.xhtml">
		<ui:define name="label">#{messages['Period.endDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{prescribedMedicine.period.endDate}"/> 
	</s:decorate>

	<s:decorate template="/layout/edit.xhtml">
		<ui:define name="label">#{messages['PrescribedMedicine.doseUnit']}:</ui:define>
		<h:selectOneMenu value="#{prescribedMedicine.doseUnit}" required="true" >
           	<f:selectItems value="#{prescribedMedicineHome.doses}" />
		</h:selectOneMenu>
	</s:decorate>

	<s:decorate template="/layout/edit.xhtml">
		<ui:define name="label">#{messages['PrescribedMedicine.frequency']}:</ui:define>
		<h:selectOneMenu value="#{prescribedMedicine.frequency}" required="true" >
			<f:selectItem itemLabel="-" itemValue="#{null}" />
           	<f:selectItems value="#{frequencies}" />
		</h:selectOneMenu>
	</s:decorate>

	<s:decorate template="/layout/edit.xhtml" rendered="#{!sources.singleResult}">
		<ui:define name="label">#{messages['Source']}:</ui:define>
		<h:selectOneMenu value="#{prescribedMedicine.source}" required="true" >
			<s:selectItems var="s" value="#{sources.resultList}" noSelectionLabel="-" label="#{s}"/>
			<s:convertEntity />
		</h:selectOneMenu>
	</s:decorate>

	<s:decorate template="/layout/edit.xhtml">
		<ui:define name="label">#{messages['global.comments']}:</ui:define>
		<h:inputTextarea value="#{prescribedMedicine.comments}" style="width:400px;height:40px;"/>
	</s:decorate>
	
	<a:commandLink value="#{messages['form.ok']}" action="#{prescribedMedicineHome.updateChanges}"
		data="#{prescribedMedicineHome.validated}"
		styleClass="button" reRender="pnltreatment,medicinepnl" 
		oncomplete="initializeTreatmentView(); if (!data) return false;Richfaces.hideModalPanel('medicinedlg');"/>
		
	<a:commandLink value="#{messages['form.cancel']}" styleClass="button-alt"  
		onclick="Richfaces.hideModalPanel('medicinedlg'); return false;"/>
	</h:form>
	</h:panelGroup>
</rich:modalPanel>





<rich:modalPanel id="hudlg" width="500" height="180" zindex="2000" trimOverlayedElements="false">
	<f:facet name="header">#{messages['cases.treat']}</f:facet>
	<ui:param name="labelstyle" value="width:110px" />
	<h:panelGroup id="hupnl" >
	<h:form style="padding:10px;" rendered="#{treatmentHome.formEditing=='HEALTHUNIT'}">

	<h:messages styleClass="error" layout="table" />
	<s:decorate template="/layout/display.xhtml" rendered="#{not treatmentHome.canChangeIniDate}">
		<ui:define name="label">#{messages['Period.iniDate']}:</ui:define>
		<h:outputText value="#{treatmentHome.iniDate}"/>
	</s:decorate>

	<s:decorate template="/layout/dateedit.xhtml" rendered="#{treatmentHome.canChangeIniDate}">
		<ui:define name="label">#{messages['Period.iniDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{treatmentHome.iniDate}"/> 
	</s:decorate>

	<s:decorate template="/layout/dateedit.xhtml">
		<ui:define name="label">#{messages['Period.endDate']}:</ui:define>
    	<ui:param name="required" value="true" /> 
    	<ui:param name="datefield" value="#{treatmentHome.endDate}"/> 
	</s:decorate>
	
	<a:commandLink value="#{messages['form.ok']}" action="#{treatmentHome.endTreatmentPeriodEditing}"
		data="#{treatmentHome.validated}"
		styleClass="button" reRender="pnltreatment,hupnl"
		oncomplete="initializeTreatmentView();if (!data) return false; Richfaces.hideModalPanel('hudlg');"/>

	<a:commandLink value="#{messages['form.cancel']}" styleClass="button-alt"  
		onclick="Richfaces.hideModalPanel('hudlg'); return false;"/>

	</h:form>
	</h:panelGroup>
</rich:modalPanel>

</ui:define>

</ui:composition>  
