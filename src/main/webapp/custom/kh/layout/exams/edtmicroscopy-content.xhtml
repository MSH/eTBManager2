<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:a="https://ajax4jsf.dev.java.net/ajax"
                xmlns:s="http://jboss.com/products/seam/taglib"
                xmlns:rich="http://richfaces.ajax4jsf.org/rich">

    <ui:param name="labelstyle" value="width:200px" />

    <div class="form-content">
        <s:decorate template="#{wspage['/layout/edtsample.xhtml']}">
            <ui:define name="before-sampleNumber">
                <s:decorate template="/layout/edit.xhtml" >
                    <ui:define name="label">#{messages['PatientSample.sampleType']}:</ui:define>
                    <h:selectOneMenu value="#{examHome.instance.sampleType}" required="true">
                        <s:selectItems value="#{sampleTypes_kh}" var="it" label="#{messages[it.key]}" noSelectionLabel="-"/>
                        <s:convertEnum />
                    </h:selectOneMenu>
                </s:decorate>

                <s:decorate template="/layout/edit.xhtml">
                    <ui:define name="label">#{messages['VisualAppearance']}:</ui:define>
                    <h:selectOneMenu id="micva" value="#{examMicroscopy.visualAppearance}">
                        <s:selectItems value="#{globalLists.microscopyVisualAppearence}" var="it" noSelectionLabel="-" label="#{messages[it.key]}" />
                        <s:convertEnum />
                    </h:selectOneMenu>
                </s:decorate>
            </ui:define>
        </s:decorate>

        <s:decorate template="/layout/edit.xhtml" >
            <ui:define name="label">#{messages['ExamStatus']}:</ui:define>
            <h:selectOneMenu id="cbres" value="#{examHome.instance.status}" required="true" onchange="examStatusChanged(this, false)">
                <s:selectItems value="#{globalLists.examStatusOptions}" var="it" noSelectionLabel="-" label="#{messages[it.key]}" />
                <s:convertEnum />
            </h:selectOneMenu>
        </s:decorate>

        <div id="divexamcontent" style="display:#{examHome.instance.status=='PERFORMED'?'block':'none   '}">
            <div class="paragraph">#{messages['cases.exams.results']}</div>
            <s:decorate template="/layout/dateedit.xhtml" >
                <ui:define name="label">#{messages['cases.exams.dateRelease']}:</ui:define>
                <ui:param name="required" value="false" />
                <ui:param name="future" value="true" />
                <ui:param name="datefield" value="#{examMicroscopy.dateRelease}" />
            </s:decorate>

            <s:decorate template="/layout/edit.xhtml" >
                <ui:define name="label">#{messages['cases.details.result']}:</ui:define>
                <h:selectOneMenu id="cbres" value="#{examMicroscopy.result}" required="true" onchange="examResultChanged(this)">
                    <s:selectItems value="#{microscopyResults}" var="it" noSelectionLabel="-" label="#{messages[it.key]}" />
                    <s:convertEnum />
                </h:selectOneMenu>
            </s:decorate>

            <rich:jQuery selector="#cbres" query="change( function(){ examResultChanged(this); })" />
            <rich:jQuery selector="#cbres" timing="onload" query="each( function(){ examResultChanged(this, true); })" />

            <div style="display:block;width:600px;">
                <div id="pnlrespositive">
                    <s:decorate template="/layout/edit.xhtml" >
                        <ui:define name="label">#{messages['cases.exams.afb']}:</ui:define>
                        <h:selectOneMenu value="#{examMicroscopy.numberOfAFB}" >
                            <f:selectItems value="#{numberOfAFBs}" />
                        </h:selectOneMenu>
                    </s:decorate>
                </div>
            </div>

            <s:decorate template="/layout/edit.xhtml" >
                <ui:define name="label">#{messages['global.comments']}:</ui:define>
                <h:inputTextarea value="#{examHome.instance.comments}" style="width:400px;height:80px;"/>
            </s:decorate>

            <h:inputHidden id="maximunSeverity" value="#{facesContext.maximumSeverity.ordinal}" rendered="#{facesContext.maximumSeverity != null}" />
        </div>

        <script type="text/javascript">
            <!--
            function examResultChanged(cb, immediate) {
                var s = cb.options[cb.selectedIndex].value;
                if (s=='POSITIVE')
                    jQuery('#pnlrespositive').show(immediate?0:500)
                else jQuery('#pnlrespositive').hide(immediate?0:500);
            }
            function examStatusChanged(cb, immediate) {
                var s = cb.options[cb.selectedIndex].value;
                if (s=='PERFORMED')
                    jQuery('#divexamcontent').slideDown(immediate?0:500)
                else jQuery('#divexamcontent').slideUp(immediate?0:500);
            }
            -->
        </script>

    </div>


</ui:composition>
